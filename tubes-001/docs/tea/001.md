# Tubes + Bubbletea: Redux-like Architecture

**Document**: `docs/tea/001.md`  
**Purpose**: Overview of how Tubes implements Redux patterns in Go using Bubbletea

---

## Core Philosophy

Tubes demonstrates how to build complex TUI applications using **Redux-inspired patterns** within the Bubbletea framework. While Bubbletea provides the foundational MVC pattern, Tubes extends this with explicit state management principles borrowed from Redux.

## The Redux Connection

### Traditional Redux Flow
```
Action → Reducer → Store → View → Action
```

### Tubes + Bubbletea Flow  
```
tea.KeyMsg → Update() → Model → View() → Commands → tea.KeyMsg
```

## Key Architectural Principles

### 1. Single Source of Truth
- **Redux**: Central store holds all application state
- **Tubes**: `Model` struct contains complete application state
- **Location**: `internal/tui/model.go:38-89`

```go
type Model struct {
    // UI state
    activePane pane
    width, height int
    
    // Domain state  
    curMode mode
    selectedPath string
    
    // App behavior
    commands map[string]Command
}
```

### 2. State is Read-Only
- **Redux**: State mutations only via reducers  
- **Tubes**: State changes only through `Update()` method
- **Location**: `internal/tui/model.go:370`

### 3. Pure Functions for State Changes
- **Redux**: Reducers are pure functions `(state, action) → newState`
- **Tubes**: `Update()` is pure function `(model, msg) → (model, cmd)`

## Architecture Benefits

### ✅ Predictable State Flow
Every state change goes through the same `Update()` pipeline, making debugging and testing straightforward.

### ✅ Time-Travel Debugging Potential  
Since all state changes are explicit messages, you could log and replay them.

### ✅ Separation of Concerns
- **Model**: What the app knows
- **View**: How the app looks  
- **Update**: How the app changes

### ✅ Testability
Pure functions make unit testing state transitions trivial.

## Implementation Details

### State Structure
```go
// Domain-specific state slices
curMode      mode   // Current operating mode
selectedPath string // UI selection state  
commands     map[string]Command // Available actions

// UI state slices
activePane   pane   // Focus management
width, height int   // Layout state
```

### Message Types (Actions)
- `tea.KeyMsg` - User input actions
- `tea.WindowSizeMsg` - Layout actions  
- `autoCompleteMsg` - Async actions
- Custom command results - Domain actions

### Update Function (Reducer)
The `Update()` method acts as the root reducer, pattern-matching on message types and returning new state.

## Comparison to React/Redux

| Concept | Redux/React | Tubes/Bubbletea |
|---------|-------------|------------------|
| Store | Redux store | Model struct |
| Actions | Action objects | tea.Msg interface |  
| Reducers | Reducer functions | Update() method |
| Components | React components | View() method |
| Middleware | Middleware chain | tea.Cmd functions |
| Selectors | Selector functions | Model methods |

## Why This Matters

This architecture makes Tubes:
1. **Maintainable** - Clear data flow
2. **Debuggable** - Explicit state changes  
3. **Testable** - Pure functions
4. **Extensible** - Easy to add new features

The Redux pattern scales from simple CLIs to complex interactive applications while maintaining code clarity.

---

**Next**: [002.md - Actions and Message Handling](./002.md)  
**See Also**: [003.md - State Management Patterns](./003.md)