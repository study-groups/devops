# Quasar Audio Guide

Complete reference for the Quasar audio engine, TIA sound synthesis, and game audio integration.

## Table of Contents

1. [Overview](#overview)
2. [Architecture](#architecture)
3. [TIA Sound Chip Emulation](#tia-sound-chip-emulation)
4. [Voice Parameters](#voice-parameters)
5. [Waveform Reference](#waveform-reference)
6. [Sound Presets](#sound-presets)
7. [OSC Protocol](#osc-protocol)
8. [WebSocket Protocol](#websocket-protocol)
9. [Integration Guide](#integration-guide)

---

## Overview

Quasar is a browser-based audio engine that emulates the Atari 2600 TIA sound chip using the Web Audio API's AudioWorklet. It provides:

- **4 independent voices** with gate, frequency, waveform, and volume control
- **16 authentic TIA waveforms** using polynomial counters (LFSR)
- **Real-time control** via WebSocket and OSC
- **Sound presets** for common game effects (pew, boom, pickup, etc.)
- **Game frame synchronization** for audio-visual coordination

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      QUASAR AUDIO ENGINE                            â”‚
â”‚                      PT100 MERIDIAN System                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚   Game State â”€â”€â–º WebSocket â”€â”€â–º QUASAR.js â”€â”€â–º TIA Worklet â”€â”€â–º Audio â”‚
â”‚                                    â”‚                                â”‚
â”‚   MIDI/OSC â”€â”€â”€â”€â–º UDP:1986 â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                                â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Architecture

### System Components

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           QUASAR SERVER (:1985)                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚   HTTP Router   â”‚    â”‚  WebSocket Hub  â”‚    â”‚   OSC Handler   â”‚         â”‚
â”‚  â”‚  Static files   â”‚    â”‚  /ws?role=...   â”‚    â”‚   UDP :1986     â”‚         â”‚
â”‚  â”‚  REST API       â”‚    â”‚  Frame relay    â”‚    â”‚  Sound commands â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚           â”‚                      â”‚                      â”‚                   â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚                                  â”‚                                          â”‚
â”‚                                  â–¼                                          â”‚
â”‚                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                  â”‚
â”‚                        â”‚  Sound State    â”‚                                  â”‚
â”‚                        â”‚  4 voices       â”‚                                  â”‚
â”‚                        â”‚  mode: tia      â”‚                                  â”‚
â”‚                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                  â”‚
â”‚                                 â”‚                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚ WebSocket broadcast
                                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           BROWSER CLIENT                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚   QUASAR.js     â”‚    â”‚  TIA Worklet    â”‚    â”‚  AudioContext   â”‚         â”‚
â”‚  â”‚  API interface  â”‚â”€â”€â”€â–ºâ”‚  DSP synthesis  â”‚â”€â”€â”€â–ºâ”‚  destination    â”‚â”€â”€â”€â–º ðŸ”Š  â”‚
â”‚  â”‚  Preset triggersâ”‚    â”‚  4 voices       â”‚    â”‚                 â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Port Allocation

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Port   â”‚ Protocol â”‚ Purpose                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1985   â”‚ TCP      â”‚ HTTP server + WebSocket             â”‚
â”‚ 1986   â”‚ UDP      â”‚ OSC input for sound commands        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### File Structure

```
$TETRA_SRC/bash/quasar/
â”œâ”€â”€ quasar_server.js          # Main server (HTTP + WS + OSC)
â”œâ”€â”€ browser/
â”‚   â”œâ”€â”€ index.html            # Client page
â”‚   â”œâ”€â”€ quasar.js             # Browser audio API
â”‚   â”œâ”€â”€ tia-worklet.js        # TIA DSP synthesis
â”‚   â””â”€â”€ terminal.js           # Display rendering
â””â”€â”€ lib/
    â”œâ”€â”€ ws_protocol.js        # WebSocket handler
    â”œâ”€â”€ osc_handler.js        # OSC/UDP handler
    â”œâ”€â”€ bridge_factory.js     # Game bridge spawner
    â”œâ”€â”€ slot_manager.js       # Channel management
    â””â”€â”€ pulsar_engine.js      # Built-in game engine
```

---

## TIA Sound Chip Emulation

### Historical Background

The TIA (Television Interface Adapter) was the custom chip in the Atari 2600 that handled both video and audio. Its audio section featured:

- 2 independent audio channels (Quasar extends to 4)
- 5-bit frequency divider (AUDF: 0-31)
- 4-bit waveform selector (AUDC: 0-15)
- 4-bit volume control (AUDV: 0-15)
- ~30 kHz base clock

### Synthesis Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         TIA AUDIO ARCHITECTURE                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                         TIA CLOCK (~30 kHz)                         â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                       â”‚
                                       â–¼
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚   FREQUENCY DIVIDER    â”‚
                          â”‚   Ã· (AUDF + 1)         â”‚
                          â”‚   AUDF: 0-31           â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚                          â”‚                          â”‚
           â–¼                          â–¼                          â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  POLY-4     â”‚           â”‚  POLY-5     â”‚           â”‚  POLY-9     â”‚
    â”‚  Period: 15 â”‚           â”‚  Period: 31 â”‚           â”‚  Period: 511â”‚
    â”‚  Taps: 0,1  â”‚           â”‚  Taps: 0,2  â”‚           â”‚  Taps: 0,4  â”‚
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
           â”‚                         â”‚                         â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
                                     â–¼
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚   WAVEFORM SELECTOR    â”‚
                          â”‚   AUDC: 0-15           â”‚
                          â”‚   Combines poly/div    â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â–¼
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚   VOLUME CONTROL       â”‚
                          â”‚   AUDV: 0-15           â”‚
                          â”‚   4-bit DAC            â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â–¼
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚    OUTPUT     â”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Polynomial Counter (LFSR)

The TIA uses Linear Feedback Shift Registers to generate pseudo-random sequences:

```
LFSR Operation (4-bit example):

    â”Œâ”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”
    â”‚ 3 â”‚ 2 â”‚ 1 â”‚ 0 â”‚  â—„â”€â”€ 4-bit register
    â””â”€â”¬â”€â”´â”€â”€â”€â”´â”€â”¬â”€â”´â”€â”€â”€â”˜
      â”‚       â”‚
      â””â”€â”€â”€XORâ”€â”˜ â”€â”€â–º feedback bit
            â”‚
            â””â”€â”€â”€â”€â”€â”€â–º shifts into MSB

    Sequence: 1111 â†’ 0111 â†’ 1011 â†’ 0101 â†’ 1010 â†’ ...
    Period: 15 (2^4 - 1)
```

**Polynomial configurations:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Counter  â”‚ Bits      â”‚ Period   â”‚ Feedback Taps            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ POLY-4   â”‚ 4         â”‚ 15       â”‚ XOR bits 0 and 1         â”‚
â”‚ POLY-5   â”‚ 5         â”‚ 31       â”‚ XOR bits 0 and 2         â”‚
â”‚ POLY-9   â”‚ 9         â”‚ 511      â”‚ XOR bits 0 and 4         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Voice Parameters

Each voice has 4 parameters matching the TIA registers:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Param    â”‚ Range   â”‚ Description                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ gate (g) â”‚ 0-1     â”‚ Sound on/off (0=silent, 1=playing)                   â”‚
â”‚ freq (f) â”‚ 0-31    â”‚ AUDF - Frequency divider (lower = higher pitch)      â”‚
â”‚ wave (w) â”‚ 0-15    â”‚ AUDC - Waveform/timbre selector                      â”‚
â”‚ vol  (v) â”‚ 0-15    â”‚ AUDV - Volume level (0=silent, 15=max)               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Frequency Calculation

```
Frequency (Hz) = TIA_CLOCK / (AUDF + 1)
               = 30000 / (AUDF + 1)

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ AUDF   â”‚ Frequency  â”‚ Musical Note (â‰ˆ)    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 0      â”‚ 30000 Hz   â”‚ (ultrasonic)        â”‚
â”‚ 1      â”‚ 15000 Hz   â”‚ (very high)         â”‚
â”‚ 4      â”‚ 6000 Hz    â”‚ ~G8                 â”‚
â”‚ 8      â”‚ 3333 Hz    â”‚ ~G7                 â”‚
â”‚ 12     â”‚ 2308 Hz    â”‚ ~D7                 â”‚
â”‚ 15     â”‚ 1875 Hz    â”‚ ~A#6                â”‚
â”‚ 20     â”‚ 1429 Hz    â”‚ ~F6                 â”‚
â”‚ 24     â”‚ 1200 Hz    â”‚ ~D6                 â”‚
â”‚ 28     â”‚ 1034 Hz    â”‚ ~C6                 â”‚
â”‚ 31     â”‚ 938 Hz     â”‚ ~A#5                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Note: TIA frequencies don't map exactly to musical notes.
      The characteristic "out of tune" sound is authentic.
```

---

## Waveform Reference

### AUDC Waveform Types

```
â”Œâ”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ AUDC â”‚ Waveform                            â”‚ Sound Character                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  0   â”‚ Silent                              â”‚ No output                      â”‚
â”‚  1   â”‚ 4-bit poly                          â”‚ Harsh noise / static           â”‚
â”‚  2   â”‚ Ã·15 â†’ 4-bit poly                    â”‚ Buzzsaw / aggressive           â”‚
â”‚  3   â”‚ 5-bit poly â†’ 4-bit poly             â”‚ Engine rumble / motor     â˜…    â”‚
â”‚  4   â”‚ Ã·2 pure tone (square)               â”‚ Clean beep / melody       â˜…    â”‚
â”‚  5   â”‚ Ã·2 â†’ 4-bit poly                     â”‚ Buzzy / distorted tone         â”‚
â”‚  6   â”‚ Ã·31 pure tone                       â”‚ Low bass / deep tone           â”‚
â”‚  7   â”‚ 5-bit poly â†’ Ã·6                     â”‚ Engine revving / growl    â˜…    â”‚
â”‚  8   â”‚ 9-bit poly                          â”‚ White noise / explosion   â˜…    â”‚
â”‚  9   â”‚ 5-bit poly                          â”‚ Softer noise / wind            â”‚
â”‚ 10   â”‚ Ã·31 â†’ 4-bit poly                    â”‚ Rumble / thunder               â”‚
â”‚ 11   â”‚ Constant high                       â”‚ DC offset (click)              â”‚
â”‚ 12   â”‚ Ã·6 pure tone                        â”‚ Melodic / musical         â˜…    â”‚
â”‚ 13   â”‚ Ã·6 pure tone                        â”‚ (same as 12)                   â”‚
â”‚ 14   â”‚ Ã·93 (Ã·31 â†’ Ã·3)                      â”‚ Very low bass                  â”‚
â”‚ 15   â”‚ 5-bit poly â†’ Ã·6                     â”‚ Lo-fi melodic / gritty         â”‚
â””â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                               â˜… = commonly used in games
```

### Waveform Visualization

```
AUDC 4 - Pure Square Wave (Ã·2):
    â”Œâ”€â”€â”€â”   â”Œâ”€â”€â”€â”   â”Œâ”€â”€â”€â”   â”Œâ”€â”€â”€â”
    â”‚   â”‚   â”‚   â”‚   â”‚   â”‚   â”‚   â”‚
â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”˜   â””â”€â”€â”€â”˜   â””â”€â”€â”€â”˜   â””â”€â”€â”€â”€

AUDC 8 - White Noise (9-bit poly):
    â”Œâ”€â” â”Œâ”â”Œâ”€â”  â”Œâ” â”Œâ”€â”€â”â”Œâ”  â”Œâ”€â”â”Œâ”
    â”‚ â”‚ â”‚â”‚â”‚ â”‚  â”‚â”‚ â”‚  â”‚â”‚â”‚  â”‚ â”‚â”‚â”‚
â”€â”€â”€â”€â”˜ â””â”€â”˜â””â”˜ â””â”€â”€â”˜â””â”€â”˜  â””â”˜â””â”€â”€â”˜ â””â”˜â””â”€â”€

AUDC 3 - Engine Rumble (5-bit â†’ 4-bit poly):
    â”Œâ”€â”€â”  â”Œâ”â”Œâ”€â” â”Œâ”€â”€â”  â”Œâ”€â”â”Œâ”  â”Œâ”€â”€â”
    â”‚  â”‚  â”‚â”‚â”‚ â”‚ â”‚  â”‚  â”‚ â”‚â”‚â”‚  â”‚  â”‚
â”€â”€â”€â”€â”˜  â””â”€â”€â”˜â””â”˜ â””â”€â”˜  â””â”€â”€â”˜ â””â”˜â””â”€â”€â”˜  â””â”€

AUDC 12 - Melodic (Ã·6):
    â”Œâ”€â”€â”     â”Œâ”€â”€â”     â”Œâ”€â”€â”     â”Œâ”€â”€â”
    â”‚  â”‚     â”‚  â”‚     â”‚  â”‚     â”‚  â”‚
â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€
```

### Waveform Selection Guide

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Use Case               â”‚ Recommended AUDC                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Laser / Pew            â”‚ 4 (square) with freq sweep highâ†’low                 â”‚
â”‚ Explosion              â”‚ 8 (white noise) with vol decay                      â”‚
â”‚ Engine Idle            â”‚ 3 (5â†’4 poly) at low freq, low vol                   â”‚
â”‚ Engine Rev             â”‚ 7 (5â†’Ã·6) at medium freq                             â”‚
â”‚ Pickup / Coin          â”‚ 12 (Ã·6 melodic) with freq sweep lowâ†’high            â”‚
â”‚ Hit / Damage           â”‚ 8 (noise) short burst                               â”‚
â”‚ Jump                   â”‚ 4 (square) quick freq sweep                         â”‚
â”‚ Background Hum         â”‚ 6 (Ã·31) or 14 (Ã·93) at low vol                      â”‚
â”‚ Menu Blip              â”‚ 4 (square) single short note                        â”‚
â”‚ Death                  â”‚ 8 (noise) + 3 (rumble) combined                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Sound Presets

Quasar includes built-in presets for common game sounds:

### Preset Definitions

```javascript
// Pew - Laser/bullet fire (Voice 2)
pew: [
  { t: 0,   gate: 1, freq: 8,  wave: 4, vol: 15 },  // Start high
  { t: 30,           freq: 12,          vol: 12 },  // Sweep down
  { t: 60,           freq: 18,          vol: 8  },
  { t: 90,           freq: 24,          vol: 4  },
  { t: 120, gate: 0 }                               // Off
]

// Boom - Explosion (Voices 2,3)
boom: [
  { t: 0,   gate: 1, freq: 2, wave: 8, vol: 15 },   // Low noise, loud
  { t: 50,           freq: 4,          vol: 14 },
  { t: 100,          freq: 6,          vol: 12 },
  { t: 150,          freq: 8,          vol: 10 },
  { t: 200,          freq: 10,         vol: 8  },
  { t: 300,          freq: 12,         vol: 5  },
  { t: 400, gate: 0 }
]

// Pickup - Item collected (Voice 2)
pickup: [
  { t: 0,   gate: 1, freq: 20, wave: 12, vol: 12 }, // Start low
  { t: 50,           freq: 15,           vol: 14 }, // Sweep up
  { t: 100,          freq: 10,           vol: 12 },
  { t: 150,          freq: 8,            vol: 10 },
  { t: 200, gate: 0 }
]

// Engine Idle - Continuous (Voice 0)
engine_idle: [
  { t: 0, gate: 1, freq: 28, wave: 3, vol: 4 }      // No end - continuous
]

// Engine Rev - Higher pitched (Voice 0)
engine_rev: [
  { t: 0, gate: 1, freq: 12, wave: 7, vol: 12 }
]
```

### Preset Timing Diagram

```
PEW (120ms total):
    vol: 15 â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘
    vol: 12 â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘
    vol:  8 â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘
    vol:  4 â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–ˆ
    gate:   â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–‘
            0   30   60   90  120 (ms)

BOOM (400ms total):
    vol: 15 â–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘
    vol: 12 â–‘â–‘â–‘â–‘â–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘
    vol:  8 â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘
    vol:  5 â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–ˆâ–ˆâ–‘â–‘â–‘â–‘
    gate:   â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–‘
            0  100  200  300  400 (ms)
```

### Available Presets

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Name         â”‚ Voice(s)   â”‚ Description                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ pew          â”‚ 2          â”‚ Laser / bullet fire                    â”‚
â”‚ boom         â”‚ 2, 3       â”‚ Explosion                              â”‚
â”‚ clank        â”‚ 3          â”‚ Metallic track sound                   â”‚
â”‚ pickup       â”‚ 2          â”‚ Item collected                         â”‚
â”‚ engine_idle  â”‚ 0          â”‚ Low engine rumble (continuous)         â”‚
â”‚ engine_rev   â”‚ 0          â”‚ Engine acceleration                    â”‚
â”‚ hit          â”‚ 3          â”‚ Damage taken                           â”‚
â”‚ score        â”‚ 2          â”‚ Point scored                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Voice Assignment Convention:
  Voice 0: Player 1 engine / continuous sounds
  Voice 1: Player 2 engine / continuous sounds
  Voice 2: Player 1 effects (pew, pickup, score)
  Voice 3: Player 2 effects (hit, clank, boom)
```

---

## OSC Protocol

### Endpoint

```
UDP Port: 1986 (configurable via OSC_IN env var)
```

### Message Format

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ OSC Address                         â”‚ Arguments                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ /quasar/{voice}/set                 â”‚ gate freq wave vol (4 ints)         â”‚
â”‚ /quasar/{voice}/gate                â”‚ 0 or 1 (int)                        â”‚
â”‚ /quasar/mode                        â”‚ "tia", "pwm", or "sidplus" (string) â”‚
â”‚ /quasar/trigger/{name}              â”‚ [voice] (optional int)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

{voice} = 0, 1, 2, or 3
{name}  = pew, boom, pickup, hit, score, clank, engine_idle, engine_rev
```

### Examples

```bash
# Set voice 0: gate=1, freq=20, wave=4, vol=12
# Using oscsend (liblo):
oscsend localhost 1986 /quasar/0/set iiii 1 20 4 12

# Gate off voice 0:
oscsend localhost 1986 /quasar/0/gate i 0

# Trigger explosion on voice 2:
oscsend localhost 1986 /quasar/trigger/boom i 2

# Switch to TIA mode:
oscsend localhost 1986 /quasar/mode s tia
```

### OSC Flow Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ MIDI        â”‚  MIDI Note On                â”‚                 â”‚
â”‚ Controller  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚  midi_bridge.c  â”‚
â”‚             â”‚                              â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                      â”‚
                                                      â”‚ OSC UDP
                                                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     /quasar/0/set 1 20 4 12  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Game Engine â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ Quasar :1986    â”‚
â”‚ (bash)      â”‚                              â”‚ OSC Handler     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                      â”‚
                                                      â”‚ Update soundState
                                                      â–¼
                                             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                             â”‚ WebSocket       â”‚
                                             â”‚ Broadcast       â”‚
                                             â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                      â”‚
                                                      â–¼
                                             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                             â”‚ Browser Clients â”‚
                                             â”‚ TIA Worklet     â”‚
                                             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## WebSocket Protocol

### Connection

```
URL: ws://localhost:1985/ws
     ws://localhost:1985/ws?role=game    (for game sources)
     ws://localhost:1985/ws?role=browser (default for browsers)
```

### Message Types

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Type (t)           â”‚ Direction â”‚ Description                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ frame              â”‚ G â†’ S     â”‚ Game frame with display + sound            â”‚
â”‚ register           â”‚ G â†’ S     â”‚ Game source registration                   â”‚
â”‚ sync               â”‚ S â†’ B     â”‚ Initial sound state sync                   â”‚
â”‚ snd                â”‚ S â†’ B     â”‚ Sound state update                         â”‚
â”‚ input              â”‚ B â†’ S â†’ G â”‚ Keyboard/gamepad input                     â”‚
â”‚ bridge.spawn       â”‚ B â†’ S     â”‚ Request game bridge spawn                  â”‚
â”‚ bridge.ready       â”‚ S â†’ B     â”‚ Bridge spawn confirmation                  â”‚
â”‚ ping/pong          â”‚ B â†” S     â”‚ Heartbeat                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Legend: G=Game, S=Server, B=Browser
```

### Frame Message Structure

```json
{
  "t": "frame",
  "seq": 1234,
  "ts": 1702756800000,
  "display": "... ASCII game display ...",
  "snd": {
    "mode": "tia",
    "v": [
      { "g": 1, "f": 28, "w": 3, "v": 4 },
      { "g": 1, "f": 28, "w": 3, "v": 4 },
      { "g": 0, "f": 0, "w": 0, "v": 0 },
      { "g": 0, "f": 0, "w": 0, "v": 0 }
    ],
    "trig": ["pew"]
  }
}
```

### Sound Update Message

```json
{
  "t": "snd",
  "snd": {
    "v": [
      { "g": 1, "f": 20, "w": 4, "v": 12 },
      { "g": 0, "f": 0, "w": 0, "v": 0 },
      { "g": 0, "f": 0, "w": 0, "v": 0 },
      { "g": 0, "f": 0, "w": 0, "v": 0 }
    ]
  }
}
```

### Sync Message (sent on connect)

```json
{
  "t": "sync",
  "snd": {
    "mode": "tia",
    "v": [
      { "g": 0, "f": 0, "w": 0, "v": 0 },
      { "g": 0, "f": 0, "w": 0, "v": 0 },
      { "g": 0, "f": 0, "w": 0, "v": 0 },
      { "g": 0, "f": 0, "w": 0, "v": 0 }
    ]
  }
}
```

---

## Integration Guide

### Browser Integration

```javascript
// Initialize audio (call after user interaction)
await QUASAR.init();
await QUASAR.resume();

// Direct voice control
QUASAR.setVoice(0, { gate: 1, freq: 20, wave: 4, vol: 12 });

// Trigger preset
QUASAR.trigger('pew');
QUASAR.trigger('boom', 3);  // Use voice 3

// Process game frame
QUASAR.processFrame(frameData);

// Stop all sounds
QUASAR.stopAll();

// Get current state
const state = QUASAR.getState();
// { initialized: true, mode: 'tia', voices: [...], contextState: 'running' }
```

### Bash Game Integration

```bash
# Send sound via OSC (requires oscsend from liblo)
quasar_sound() {
    local voice="$1" gate="$2" freq="$3" wave="$4" vol="$5"
    oscsend localhost 1986 /quasar/$voice/set iiii "$gate" "$freq" "$wave" "$vol"
}

# Trigger preset
quasar_trigger() {
    local name="$1"
    oscsend localhost 1986 /quasar/trigger/$name
}

# Usage in game loop
quasar_sound 0 1 28 3 4      # Engine idle on voice 0
quasar_trigger pew           # Fire sound
quasar_sound 0 1 12 7 12     # Engine rev
```

### Node.js Bridge Integration

```javascript
const WebSocket = require('ws');

// Connect as game source
const ws = new WebSocket('ws://localhost:1985/ws?role=game');

ws.on('open', () => {
    // Register game type
    ws.send(JSON.stringify({ t: 'register', gameType: 'mygame' }));
});

// Send frame with sound
function sendFrame(display, soundState, triggers) {
    ws.send(JSON.stringify({
        t: 'frame',
        seq: frameSeq++,
        ts: Date.now(),
        display,
        snd: {
            mode: 'tia',
            v: soundState,
            trig: triggers
        }
    }));
}

// Example: fire sound effect
sendFrame(gameDisplay, voices, ['pew']);
```

### Starting Quasar with TSM

```bash
# Start Quasar server
tsm start quasar

# Or with custom ports
PORT=1985 OSC_IN=1986 tsm start node quasar_server.js

# Check status
tsm list
tsm logs quasar -f

# Test OSC
oscsend localhost 1986 /quasar/trigger/pew
```

---

## Quick Reference

### Voice Parameter Ranges

```
gate (g): 0-1     (off/on)
freq (f): 0-31    (lower = higher pitch)
wave (w): 0-15    (waveform type)
vol  (v): 0-15    (volume level)
```

### Common Waveforms

```
AUDC 3  - Engine rumble (5â†’4 poly)
AUDC 4  - Clean square wave
AUDC 7  - Engine rev (5â†’Ã·6)
AUDC 8  - White noise
AUDC 12 - Melodic tone (Ã·6)
```

### OSC Quick Reference

```
/quasar/{0-3}/set {g} {f} {w} {v}   # Set voice params
/quasar/{0-3}/gate {0|1}            # Gate on/off
/quasar/trigger/{preset}            # Fire preset
/quasar/mode {tia|pwm|sidplus}      # Change mode
```

### WebSocket Quick Reference

```
ws://localhost:1985/ws              # Browser client
ws://localhost:1985/ws?role=game    # Game source

Messages:
  { t: 'frame', snd: { v: [...], trig: [...] } }
  { t: 'snd', snd: { v: [...] } }
  { t: 'sync', snd: { mode: 'tia', v: [...] } }
```
