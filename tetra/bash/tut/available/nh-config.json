{
  "metadata": {
    "title": "NH Configuration",
    "tagline": "Environment variables and settings for NodeHolder",
    "version": "0.0.1",
    "author": "tetra",
    "updated": "2025-12-06T00:20:28Z"
  },
  "groups": [
    {
      "id": "core",
      "title": "Core Settings",
      "topics": [
        {
          "id": "directories",
          "title": "Directory Configuration",
          "description": "NH follows the tetra pattern: *_SRC for source, *_DIR for data",
          "content": [
            {
              "type": "table",
              "headers": [
                "Variable",
                "Default",
                "Description"
              ],
              "rows": [
                [
                  "NH_SRC",
                  "$(dirname $BASH_SOURCE)",
                  "Source directory containing nh bash scripts"
                ],
                [
                  "NH_DIR",
                  "$HOME/nh",
                  "Data directory for contexts and cached infrastructure"
                ]
              ]
            },
            {
              "type": "code-block",
              "code": "# Typical structure\n$NH_DIR/\n├── myorg/              # Context directory\n│   ├── digocean.json   # Cached infrastructure\n│   ├── digocean.env    # Generated IP exports\n│   └── aliases.env     # Short variable aliases\n└── otherorg/           # Another context",
              "caption": "NH_DIR structure per context"
            }
          ]
        },
        {
          "id": "context",
          "title": "Context Management",
          "description": "NH supports multiple DigitalOcean accounts via contexts",
          "content": [
            {
              "type": "table",
              "headers": [
                "Variable",
                "Default",
                "Description"
              ],
              "rows": [
                [
                  "DIGITALOCEAN_CONTEXT",
                  "(none)",
                  "Current active context name, synced with doctl"
                ]
              ]
            },
            {
              "type": "paragraph",
              "text": "Contexts map 1:1 with doctl auth contexts. When you run <code>nh switch myorg</code>, it sets DIGITALOCEAN_CONTEXT and calls <code>doctl auth switch --context myorg</code>."
            },
            {
              "type": "command-list",
              "commands": [
                {
                  "code": "nh list",
                  "description": "List available contexts"
                },
                {
                  "code": "nh switch <name>",
                  "description": "Switch to context (also loads env vars)"
                },
                {
                  "code": "nh create <name>",
                  "description": "Create new context directory"
                },
                {
                  "code": "nh link <short> <ctx>",
                  "description": "Create symlink alias for context"
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "id": "fetch",
      "title": "Fetch Configuration",
      "topics": [
        {
          "id": "fetch-resources",
          "title": "Resource Discovery",
          "description": "Control what NH fetches from DigitalOcean API",
          "content": [
            {
              "type": "table",
              "headers": [
                "Variable",
                "Default",
                "Description"
              ],
              "rows": [
                [
                  "NH_FETCH_RESOURCES",
                  "Droplets,Domains,SSHKeys,FloatingIPs",
                  "Comma-separated list of resources to fetch"
                ]
              ]
            },
            {
              "type": "paragraph",
              "text": "Available resources: Droplets, Domains, SSHKeys, FloatingIPs, Volumes, LoadBalancers, Firewalls, Databases, Kubernetes, Apps, Projects, VPCs"
            },
            {
              "type": "command-list",
              "commands": [
                {
                  "code": "nh fetch help",
                  "description": "Show available resources and current config"
                },
                {
                  "code": "nh fetch dry-run",
                  "description": "Preview what would be fetched"
                },
                {
                  "code": "nh fetch minimal",
                  "description": "Fetch only Droplets,Domains"
                },
                {
                  "code": "nh fetch full",
                  "description": "Fetch all available resources"
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "id": "env",
      "title": "Environment Variables",
      "topics": [
        {
          "id": "server-vars",
          "title": "Server IP Variables",
          "description": "NH exports server IPs as shell variables for easy SSH access",
          "content": [
            {
              "type": "paragraph",
              "text": "After <code>nh load</code>, each server becomes a variable. Dashes in names become underscores."
            },
            {
              "type": "table",
              "headers": [
                "Pattern",
                "Example",
                "Description"
              ],
              "rows": [
                [
                  "$servername",
                  "$pxjam_arcade_qa01",
                  "Public IP address"
                ],
                [
                  "$servername_private",
                  "$pxjam_arcade_qa01_private",
                  "Private/VPC IP address"
                ],
                [
                  "$servername_floating",
                  "$pxjam_arcade_qa01_floating",
                  "Floating IP (if assigned)"
                ]
              ]
            },
            {
              "type": "code-block",
              "code": "# After: nh switch myorg && nh load\nssh root@$pxjam_arcade_qa01\nscp file.txt root@$pxjam_arcade_qa01:/tmp/",
              "caption": "Using server variables"
            }
          ]
        },
        {
          "id": "aliases",
          "title": "Short Aliases",
          "description": "Abbreviated variable names for faster typing",
          "content": [
            {
              "type": "paragraph",
              "text": "Aliases compress server names: <code>pxjam_arcade_qa01</code> → <code>$paq</code> (first letter of each word part)"
            },
            {
              "type": "table",
              "headers": [
                "Full Variable",
                "Alias",
                "Rule"
              ],
              "rows": [
                [
                  "pxjam_arcade_qa01",
                  "$paq",
                  "p + a + q (first letters)"
                ],
                [
                  "pxjam_arcade_dev01",
                  "$pad",
                  "p + a + d"
                ],
                [
                  "do4_n2",
                  "$do4n2",
                  "Letter+digit parts kept as-is"
                ],
                [
                  "*_private",
                  "*p",
                  "Suffix 'p' for private IP"
                ],
                [
                  "*_floating",
                  "*f",
                  "Suffix 'f' for floating IP"
                ]
              ]
            },
            {
              "type": "command-list",
              "commands": [
                {
                  "code": "nh alias show <prefix>",
                  "description": "Preview aliases for servers matching prefix"
                },
                {
                  "code": "nh alias make <prefix>",
                  "description": "Create and load aliases"
                },
                {
                  "code": "nh alias clear",
                  "description": "Unset all aliases"
                },
                {
                  "code": "nh alias",
                  "description": "Show currently loaded aliases"
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "id": "checklist",
      "title": "Checklist Configuration",
      "topics": [
        {
          "id": "checklist-file",
          "title": "Checklist File Location",
          "description": "NH can navigate and track progress through markdown checklists",
          "content": [
            {
              "type": "table",
              "headers": [
                "Variable",
                "Default",
                "Description"
              ],
              "rows": [
                [
                  "NH_CHECKLIST",
                  "${NH_SRC%/bash}/checklist.md",
                  "Path to markdown checklist file"
                ]
              ]
            },
            {
              "type": "paragraph",
              "text": "Progress is stored in <code>$NH_DIR/$DIGITALOCEAN_CONTEXT/checklist.env</code> as completed step keys."
            }
          ]
        }
      ]
    },
    {
      "id": "files",
      "title": "Generated Files",
      "topics": [
        {
          "id": "data-files",
          "title": "Data Files",
          "description": "Files created per context in NH_DIR",
          "content": [
            {
              "type": "table",
              "headers": [
                "File",
                "Created By",
                "Description"
              ],
              "rows": [
                [
                  "digocean.json",
                  "nh fetch",
                  "Cached DigitalOcean infrastructure (Droplets, Domains, SSHKeys, etc.)"
                ],
                [
                  "digocean.json.bak",
                  "nh fetch",
                  "Backup of previous JSON before fetch overwrites"
                ],
                [
                  "digocean.env",
                  "nh load",
                  "Generated export statements for server IPs"
                ],
                [
                  "aliases.env",
                  "nh alias make",
                  "Short variable aliases"
                ],
                [
                  "checklist.env",
                  "nh cl check",
                  "Completed checklist steps"
                ]
              ]
            },
            {
              "type": "code-block",
              "code": "# digocean.env example\nexport pxjam_arcade_qa01=167.99.123.45  # nyc3, 2048MB\nexport pxjam_arcade_qa01_private=10.132.0.2  # private\nexport pxjam_arcade_qa01_floating=167.99.200.1  # floating",
              "caption": "Generated environment file"
            }
          ]
        }
      ]
    }
  ]
}
