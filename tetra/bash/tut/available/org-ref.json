{
  "metadata": {
    "title": "Org Reference",
    "tagline": "Infrastructure Management for Tetra",
    "description": "Reference for the org module - managing organizations, environments, and SSH connectivity",
    "version": "0.0.3",
    "author": "tetra",
    "created": "2025-12-07T00:00:00Z",
    "updated": "2025-12-08T20:48:45Z"
  },
  "groups": [
    {
      "id": "overview",
      "title": "Overview",
      "topics": [
        {
          "id": "architecture",
          "title": "Architecture",
          "description": "The org module manages WHERE your servers are. It defines infrastructure, not what you deploy to it.",
          "content": [
            {
              "type": "code-block",
              "code": "$TETRA_DIR/orgs/<name>/\n├── tetra.toml         # Active config (generated or direct)\n├── sections/          # Source partials for build\n│   ├── 00-org.toml\n│   ├── 10-infrastructure.toml\n│   └── ...\n└── backups/           # Backup directory\n\n$TETRA_DIR/config/tetra.toml  ->  symlink to active org"
            },
            {
              "type": "paragraph",
              "text": "The active org's tetra.toml is symlinked to `$TETRA_DIR/config/tetra.toml`. Switching orgs updates this symlink and exports environment variables (`$dev`, `$staging`, `$prod`) with server IPs."
            }
          ]
        },
        {
          "id": "quickstart",
          "title": "Quick Start",
          "description": "Common workflow for using org.",
          "content": [
            {
              "type": "code-block",
              "code": "# List available orgs\norg list\n\n# Switch to an org (exports $dev, $staging, $prod)\norg switch pixeljam-arcade\n\n# Check status\norg status\n\n# SSH to a server\nssh root@$dev"
            }
          ]
        }
      ]
    },
    {
      "id": "commands",
      "title": "Commands",
      "topics": [
        {
          "id": "status",
          "title": "Status & Info",
          "description": "View current org state and connectivity.",
          "content": [
            {
              "type": "command-list",
              "commands": [
                {
                  "code": "org status",
                  "description": "Show active org, connectors, and dirty status"
                },
                {
                  "code": "org list",
                  "description": "List all orgs (* marks active)"
                },
                {
                  "code": "org path",
                  "description": "Show path to active tetra.toml"
                }
              ]
            }
          ]
        },
        {
          "id": "switching",
          "title": "Switching Orgs",
          "description": "Change active organization.",
          "content": [
            {
              "type": "command-list",
              "commands": [
                {
                  "code": "org switch <name>",
                  "description": "Activate org, export $dev/$staging/$prod"
                },
                {
                  "code": "org create <name>",
                  "description": "Create new org with template tetra.toml"
                }
              ]
            },
            {
              "type": "code-block",
              "code": "# Switch and verify\norg switch pixeljam-arcade\necho $dev     # 137.184.226.163\necho $prod    # 64.23.151.249"
            }
          ]
        },
        {
          "id": "aliases",
          "title": "Aliases",
          "description": "Create short names for orgs.",
          "content": [
            {
              "type": "command-list",
              "commands": [
                {
                  "code": "org alias",
                  "description": "List all aliases"
                },
                {
                  "code": "org alias <short> <canonical>",
                  "description": "Create alias (symlink)"
                },
                {
                  "code": "org unalias <short>",
                  "description": "Remove alias"
                }
              ]
            },
            {
              "type": "code-block",
              "code": "# Create short alias\norg alias pja pixeljam-arcade\norg switch pja  # Same as pixeljam-arcade"
            }
          ]
        },
        {
          "id": "toml-view",
          "title": "Viewing Config",
          "description": "Read tetra.toml contents.",
          "content": [
            {
              "type": "command-list",
              "commands": [
                {
                  "code": "org view",
                  "description": "Show entire tetra.toml"
                },
                {
                  "code": "org view <prefix>",
                  "description": "Show sections matching prefix"
                },
                {
                  "code": "org section <name>",
                  "description": "Show specific section"
                },
                {
                  "code": "org sections",
                  "description": "List all section names"
                }
              ]
            },
            {
              "type": "code-block",
              "code": "# View all environments\norg view env\n\n# View specific section\norg section env.prod"
            }
          ]
        },
        {
          "id": "toml-edit",
          "title": "Editing Config",
          "description": "Modify tetra.toml values.",
          "content": [
            {
              "type": "command-list",
              "commands": [
                {
                  "code": "org edit",
                  "description": "Open tetra.toml in $EDITOR"
                },
                {
                  "code": "org get <path>",
                  "description": "Get value (e.g., env.dev.host)"
                },
                {
                  "code": "org set <path> <value>",
                  "description": "Set value"
                },
                {
                  "code": "org validate",
                  "description": "Check TOML syntax"
                }
              ]
            },
            {
              "type": "code-block",
              "code": "# Get and set values\norg get env.dev.host\norg set env.dev.domain dev.example.com"
            }
          ]
        },
        {
          "id": "environments",
          "title": "Environments",
          "description": "SSH connectivity via environment definitions.",
          "content": [
            {
              "type": "command-list",
              "commands": [
                {
                  "code": "org env",
                  "description": "List environments with connection info"
                },
                {
                  "code": "org env <name>",
                  "description": "Show details for environment"
                }
              ]
            },
            {
              "type": "code-block",
              "code": "# List environments\norg env\n\n# Output:\n# Environments for: pixeljam-arcade\n#   dev          root@137.184.226.163\n#   staging      root@146.190.151.245\n#   prod         root@64.23.151.249"
            },
            {
              "type": "paragraph",
              "text": "Environment IPs are exported as shell variables after `org switch`. Use them directly with ssh: `ssh root@$dev`"
            }
          ]
        }
      ]
    },
    {
      "id": "build",
      "title": "Build System",
      "topics": [
        {
          "id": "build-overview",
          "title": "Overview",
          "description": "Assemble tetra.toml from section partials.",
          "content": [
            {
              "type": "paragraph",
              "text": "Large configurations can be split into numbered section files in `sections/`. The build command assembles them into a single tetra.toml."
            },
            {
              "type": "code-block",
              "code": "sections/\n├── 00-org.toml           # [org] identity\n├── 10-infrastructure.toml # [env.*]\n├── 20-storage.toml       # [storage.*]\n├── 30-resources.toml     # [resources.*]\n├── 40-services.toml      # [services]\n└── 50-custom.toml        # Custom sections"
            }
          ]
        },
        {
          "id": "build-commands",
          "title": "Build Commands",
          "description": "Initialize and build org configurations.",
          "content": [
            {
              "type": "command-list",
              "commands": [
                {
                  "code": "org init [name]",
                  "description": "Create sections/ with templates"
                },
                {
                  "code": "org build [name]",
                  "description": "Assemble sections into tetra.toml"
                },
                {
                  "code": "org sections [name]",
                  "description": "List section files"
                }
              ]
            },
            {
              "type": "code-block",
              "code": "# Initialize new org with sections\norg init myorg\n\n# Edit sections\nvim $TETRA_DIR/orgs/myorg/sections/10-infrastructure.toml\n\n# Build (validates and assembles)\norg build myorg\n\n# Switch to use it\norg switch myorg"
            }
          ]
        },
        {
          "id": "dirty-status",
          "title": "Dirty Detection",
          "description": "Track when rebuild is needed.",
          "content": [
            {
              "type": "paragraph",
              "text": "If any section file is newer than tetra.toml, the org shows as `(dirty)` in status. Run `org build` to rebuild."
            },
            {
              "type": "code-block",
              "code": "# Check if rebuild needed\norg status\n# Output: Config: /path/to/tetra.toml (dirty)\n\n# Rebuild\norg build"
            }
          ]
        }
      ]
    },
    {
      "id": "import",
      "title": "Import",
      "topics": [
        {
          "id": "import-nh",
          "title": "Import from Nodeholder",
          "description": "Import infrastructure from DigitalOcean via Nodeholder.",
          "content": [
            {
              "type": "command-list",
              "commands": [
                {
                  "code": "org import nh <org>",
                  "description": "Import $NH_DIR/<org>/digocean.json"
                },
                {
                  "code": "org import nh <org> <json>",
                  "description": "Import specific JSON file"
                },
                {
                  "code": "org import list <org>",
                  "description": "Preview droplets before import"
                }
              ]
            },
            {
              "type": "code-block",
              "code": "# Preview what will be imported\norg import list pixeljam\n\n# Import infrastructure\norg import nh pixeljam\n\n# Creates/updates:\n#   $TETRA_DIR/orgs/pixeljam/sections/10-infrastructure.toml"
            }
          ]
        }
      ]
    },
    {
      "id": "tetra-toml",
      "title": "tetra.toml Schema",
      "collapsed": true,
      "topics": [
        {
          "id": "toml-org",
          "title": "[org] Section",
          "description": "Organization identity.",
          "content": [
            {
              "type": "code-block",
              "code": "[org]\nname = \"pixeljam-arcade\""
            }
          ]
        },
        {
          "id": "toml-env",
          "title": "[env.*] Sections",
          "description": "Server connection definitions.",
          "content": [
            {
              "type": "code-block",
              "code": "[env.local]\ndescription = \"Local development\"\n\n[env.dev]\ndescription = \"Development server\"\nhost = \"137.184.226.163\"\nauth_user = \"root\"\nwork_user = \"dev\"\ndomain = \"dev.pixeljamarcade.com\"\n\n[env.staging]\ndescription = \"Staging server\"\nhost = \"146.190.151.245\"\nauth_user = \"root\"\nwork_user = \"staging\"\ndomain = \"staging.pixeljamarcade.com\"\n\n[env.prod]\ndescription = \"Production server\"\nhost = \"64.23.151.249\"\nauth_user = \"root\"\nwork_user = \"prod\"\ndomain = \"pixeljamarcade.com\""
            },
            {
              "type": "table",
              "headers": [
                "Key",
                "Description"
              ],
              "rows": [
                [
                  "host",
                  "Public IP address"
                ],
                [
                  "auth_user",
                  "SSH login user (typically root)"
                ],
                [
                  "work_user",
                  "User to switch to after login"
                ],
                [
                  "domain",
                  "Domain name for this environment"
                ],
                [
                  "description",
                  "Human-readable description"
                ]
              ]
            }
          ]
        }
      ]
    },
    {
      "id": "tab-completion",
      "title": "Tab Completion",
      "collapsed": true,
      "topics": [
        {
          "id": "completion-overview",
          "title": "Completion Support",
          "description": "Tab completion for all org commands.",
          "content": [
            {
              "type": "paragraph",
              "text": "The org command supports bash tab completion for subcommands, org names, section names, and key paths."
            },
            {
              "type": "code-block",
              "code": "org sw<TAB>          # -> org switch\norg switch pix<TAB>  # -> org switch pixeljam-arcade\norg get env<TAB>     # -> org get env.\norg get env.dev.<TAB>  # -> host, auth_user, domain..."
            }
          ]
        }
      ]
    }
  ]
}
