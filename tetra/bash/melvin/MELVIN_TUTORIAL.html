<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MELVIN Interactive Tutorial</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-primary: #0d1117;
            --bg-secondary: #161b22;
            --bg-tertiary: #21262d;
            --text-primary: #c9d1d9;
            --text-secondary: #8b949e;
            --accent-primary: #58a6ff;
            --accent-secondary: #1f6feb;
            --success: #3fb950;
            --warning: #d29922;
            --error: #f85149;
            --border: #30363d;
            --highlight: #388bfd26;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', sans-serif;
            background: var(--bg-primary);
            min-height: 100vh;
            padding: 0;
            color: var(--text-primary);
            margin: 0;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0;
            align-items: start;
            padding: 1rem;
        }

        .panel {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 6px;
            overflow: hidden;
            min-height: 600px;
        }

        .narrative-panel {
            margin-right: 0.5rem;
        }

        .terminal-panel {
            position: sticky;
            top: 1rem;
            margin-left: 0.5rem;
            max-height: calc(100vh - 2rem);
            overflow: hidden;
        }

        .panel-header {
            padding: 0.75rem 1rem;
            font-weight: 600;
            font-size: 0.85rem;
            letter-spacing: 0.3px;
            border-bottom: 1px solid var(--border);
            background: var(--bg-tertiary);
            color: var(--text-secondary);
        }

        /* Narrative Styles */
        .narrative-content {
            padding: 2rem;
            line-height: 1.7;
            overflow-y: auto;
        }

        .step {
            margin-bottom: 3rem;
            display: none;
        }

        .step.active {
            display: block;
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .step-number {
            display: inline-block;
            background: var(--bg-tertiary);
            color: var(--accent-primary);
            padding: 0.25rem 0.75rem;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: 600;
            margin-bottom: 1rem;
            border: 1px solid var(--border);
            font-family: 'Courier New', monospace;
        }

        .step h2 {
            color: var(--text-primary);
            margin-bottom: 1rem;
            font-size: 1.4rem;
            font-weight: 600;
        }

        .step h3 {
            color: var(--text-primary);
            margin-top: 2rem;
            margin-bottom: 1rem;
            font-size: 1.1rem;
            font-weight: 600;
        }

        .step p {
            margin-bottom: 1rem;
            color: var(--text-secondary);
        }

        .you-try {
            background: var(--bg-tertiary);
            border: 1px solid var(--warning);
            padding: 1.25rem;
            margin: 1.5rem 0;
            border-radius: 6px;
        }

        .you-try-header {
            font-weight: 700;
            color: var(--warning);
            margin-bottom: 0.75rem;
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .you-try-header::before {
            content: "‚Üí";
            font-size: 1.2rem;
            font-weight: bold;
        }

        .you-try p {
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
        }

        .command-hint {
            background: var(--bg-primary);
            padding: 0.75rem 1rem;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 0.85rem;
            color: var(--accent-primary);
            margin-top: 0.5rem;
            border: 1px solid var(--border);
            overflow-x: auto;
        }

        .learn-box {
            background: var(--bg-tertiary);
            border: 1px solid var(--accent-secondary);
            padding: 1.25rem;
            margin: 1.5rem 0;
            border-radius: 6px;
        }

        .learn-box-header {
            font-weight: 700;
            color: var(--accent-primary);
            margin-bottom: 0.75rem;
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .learn-box-header::before {
            content: "‚Ñπ";
            font-size: 1.2rem;
            font-weight: bold;
        }

        .learn-box ul {
            margin-left: 1.5rem;
            color: var(--text-secondary);
        }

        .learn-box li {
            margin-bottom: 0.4rem;
        }

        .learn-box p {
            color: var(--text-secondary);
        }

        /* Terminal Styles */
        .terminal-window {
            background: var(--bg-primary);
            height: 100%;
            min-height: 600px;
            max-height: calc(100vh - 2rem);
            font-family: 'Courier New', Monaco, monospace;
            font-size: 13px;
            position: relative;
            display: flex;
            flex-direction: column;
        }

        .terminal-titlebar {
            background: var(--bg-tertiary);
            padding: 0.5rem 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            border-bottom: 1px solid var(--border);
            flex-shrink: 0;
        }

        .terminal-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        .dot-red { background: #ff5f56; }
        .dot-yellow { background: #ffbd2e; }
        .dot-green { background: #27c93f; }

        .terminal-title {
            margin-left: 1rem;
            color: var(--text-secondary);
            font-size: 0.75rem;
        }

        .terminal-content {
            padding: 1.5rem;
            color: var(--text-primary);
            overflow-y: auto;
            flex: 1;
        }

        .terminal-line {
            margin-bottom: 0.5rem;
            display: none;
        }

        .terminal-line.visible {
            display: block;
            animation: terminalFadeIn 0.3s ease-in;
        }

        @keyframes terminalFadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .prompt {
            color: var(--success);
        }

        .command {
            color: var(--accent-primary);
        }

        .output {
            color: var(--text-secondary);
        }

        .output-header {
            color: var(--accent-primary);
            font-weight: bold;
        }

        .output-success {
            color: var(--success);
        }

        .output-warning {
            color: var(--warning);
        }

        .output-error {
            color: var(--error);
        }

        .comment {
            color: var(--text-secondary);
            opacity: 0.7;
        }

        .highlight {
            background: var(--highlight);
            padding: 0 0.2rem;
        }

        /* Navigation */
        .navigation {
            display: flex;
            gap: 1rem;
            padding: 1rem;
            background: var(--bg-tertiary);
            border-bottom: 1px solid var(--border);
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .nav-button {
            padding: 0.6rem 1.5rem;
            border: 1px solid var(--border);
            border-radius: 4px;
            font-weight: 600;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.2s ease;
            background: var(--bg-secondary);
            color: var(--text-primary);
        }

        .nav-button:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        .nav-prev:hover:not(:disabled) {
            background: var(--bg-tertiary);
            border-color: var(--accent-primary);
        }

        .nav-next {
            background: var(--accent-secondary);
            border-color: var(--accent-secondary);
            color: white;
        }

        .nav-next:hover:not(:disabled) {
            background: var(--accent-primary);
            border-color: var(--accent-primary);
        }

        .progress {
            text-align: center;
            color: var(--text-secondary);
            font-size: 0.85rem;
            padding: 0.5rem;
            flex: 1;
            font-family: 'Courier New', monospace;
        }

        /* Header */
        .tutorial-header {
            text-align: center;
            color: var(--text-primary);
            padding: 2rem 1rem 1rem;
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border);
        }

        .tutorial-header h1 {
            font-size: 2rem;
            margin-bottom: 0.5rem;
            font-weight: 700;
            color: var(--accent-primary);
        }

        .tutorial-header p {
            font-size: 1rem;
            color: var(--text-secondary);
        }

        code {
            background: var(--bg-tertiary);
            padding: 0.2rem 0.4rem;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            color: var(--accent-primary);
            border: 1px solid var(--border);
        }

        ul {
            color: var(--text-secondary);
        }

        /* Design Token FAB */
        .design-fab {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            width: 56px;
            height: 56px;
            border-radius: 50%;
            background: var(--accent-secondary);
            border: 2px solid var(--accent-primary);
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0,0,0,0.4);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            z-index: 1000;
        }

        .design-fab:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(0,0,0,0.5);
        }

        .design-panel {
            position: fixed;
            bottom: 5rem;
            right: 2rem;
            width: 320px;
            max-height: 70vh;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 8px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.5);
            display: none;
            flex-direction: column;
            z-index: 999;
            overflow: hidden;
        }

        .design-panel.visible {
            display: flex;
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .design-panel-header {
            padding: 1rem;
            background: var(--bg-tertiary);
            border-bottom: 1px solid var(--border);
            font-weight: 600;
            color: var(--text-primary);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .design-panel-close {
            cursor: pointer;
            color: var(--text-secondary);
            font-size: 1.2rem;
        }

        .design-panel-content {
            padding: 1rem;
            overflow-y: auto;
            flex: 1;
        }

        /* Styled scrollbar for design panel */
        .design-panel-content::-webkit-scrollbar {
            width: 8px;
        }

        .design-panel-content::-webkit-scrollbar-track {
            background: var(--bg-primary);
            border-radius: 4px;
        }

        .design-panel-content::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 4px;
        }

        .design-panel-content::-webkit-scrollbar-thumb:hover {
            background: var(--accent-primary);
        }

        .token-group {
            margin-bottom: 1.5rem;
        }

        .token-group-title {
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--text-secondary);
            margin-bottom: 0.75rem;
            font-weight: 600;
        }

        .token-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 0.5rem;
        }

        .token-swatch {
            width: 32px;
            height: 32px;
            border-radius: 4px;
            border: 1px solid var(--border);
            flex-shrink: 0;
        }

        .token-info {
            flex: 1;
            min-width: 0;
        }

        .token-name {
            font-size: 0.75rem;
            font-family: 'Courier New', monospace;
            color: var(--text-secondary);
            margin-bottom: 0.15rem;
        }

        .token-value {
            font-size: 0.7rem;
            font-family: 'Courier New', monospace;
            color: var(--accent-primary);
        }

        .token-picker {
            width: 32px;
            height: 32px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .font-select {
            width: 100%;
            padding: 0.5rem;
            background: var(--bg-primary);
            color: var(--text-primary);
            border: 1px solid var(--border);
            border-radius: 4px;
            font-size: 0.85rem;
            cursor: pointer;
            margin-top: 0.5rem;
        }

        .font-select:focus {
            outline: none;
            border-color: var(--accent-primary);
        }

        .font-input {
            width: 100%;
            padding: 0.5rem;
            background: var(--bg-primary);
            color: var(--text-primary);
            border: 1px solid var(--border);
            border-radius: 4px;
            font-size: 0.8rem;
            font-family: 'Courier New', monospace;
            margin-top: 0.5rem;
        }

        .font-input:focus {
            outline: none;
            border-color: var(--accent-primary);
        }

        .font-input::placeholder {
            color: var(--text-secondary);
            opacity: 0.5;
        }

        .add-font-btn {
            width: 100%;
            padding: 0.4rem;
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border: 1px solid var(--border);
            border-radius: 4px;
            font-size: 0.75rem;
            cursor: pointer;
            margin-top: 0.5rem;
            transition: all 0.2s ease;
        }

        .add-font-btn:hover {
            border-color: var(--accent-primary);
            color: var(--accent-primary);
        }

        .font-example-toggle {
            font-size: 0.75rem;
            color: var(--accent-primary);
            cursor: pointer;
            margin-top: 0.5rem;
            display: inline-block;
            user-select: none;
        }

        .font-example-toggle:hover {
            text-decoration: underline;
        }

        .font-example-content {
            display: none;
            margin-top: 0.5rem;
            padding: 0.75rem;
            background: var(--bg-tertiary);
            border-radius: 4px;
            font-size: 0.7rem;
            color: var(--text-secondary);
            line-height: 1.6;
        }

        .font-example-content.expanded {
            display: block;
        }

        .font-example-content ol {
            margin: 0.5rem 0;
            padding-left: 1.5rem;
        }

        .font-example-content li {
            margin-bottom: 0.5rem;
        }

        .font-example-content code {
            background: var(--bg-primary);
            padding: 0.2rem 0.4rem;
            border-radius: 2px;
            font-size: 0.65rem;
        }

        .design-panel-buttons {
            display: flex;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .design-panel-btn {
            flex: 1;
            padding: 0.5rem;
            border: 1px solid var(--border);
            border-radius: 4px;
            font-weight: 600;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .copy-tokens-btn {
            background: var(--accent-secondary);
            color: white;
            border-color: var(--accent-primary);
        }

        .copy-tokens-btn:hover {
            background: var(--accent-primary);
        }

        .copy-tokens-btn.copied {
            background: var(--success);
            border-color: var(--success);
        }

        .reset-tokens-btn {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border-color: var(--border);
        }

        .reset-tokens-btn:hover {
            background: var(--bg-primary);
            border-color: var(--warning);
            color: var(--warning);
        }

        @media (max-width: 1200px) {
            .container {
                grid-template-columns: 1fr;
            }

            .terminal-panel {
                position: relative;
                top: 0;
                max-height: 600px;
                margin-left: 0;
                margin-top: 1rem;
            }

            .narrative-panel {
                margin-right: 0;
            }
        }
    </style>
</head>
<body>
    <div class="tutorial-header">
        <h1>MELVIN Interactive Tutorial</h1>
        <p>Learn the Tetra Way: Build a Notes Module Step-by-Step</p>
    </div>

    <div class="navigation">
        <button class="nav-button nav-prev" onclick="prevStep()" id="prevBtn" disabled>‚Üê Previous</button>
        <div class="progress" id="progress">Step 1 of 12</div>
        <button class="nav-button nav-next" onclick="nextStep()" id="nextBtn">Next ‚Üí</button>
    </div>

    <div class="container">
        <!-- Narrative Panel (Left) -->
        <div class="panel narrative-panel">
            <div class="panel-header">Tutorial Guide</div>
            <div class="narrative-content">

                <!-- Step 0: Introduction -->
                <div class="step active" data-step="0">
                    <span class="step-number">Welcome</span>
                    <h2>Welcome to the MELVIN Tutorial</h2>
                    <p>
                        In this interactive tutorial, you'll learn how to use MELVIN (Machine Electronics Live Virtual Intelligence Network)
                        to build a new tetra module the right way.
                    </p>
                    <p>
                        <strong>What you'll learn:</strong>
                    </p>
                    <ul style="margin-left: 2rem; margin-bottom: 1rem;">
                        <li>How to bootstrap MELVIN in your terminal</li>
                        <li>Understanding tetra's architecture patterns</li>
                        <li>Strong globals, no dotfiles, and module types</li>
                        <li>Building a complete module with MELVIN's guidance</li>
                    </ul>

                    <div class="learn-box">
                        <div class="learn-box-header">Prerequisites</div>
                        <p>Before starting, make sure you have:</p>
                        <ul>
                            <li>Bash 5.2+ installed</li>
                            <li>Tetra cloned and accessible at ~/tetra</li>
                            <li>A terminal window open</li>
                        </ul>
                    </div>

                    <p>
                        The right panel shows a simulated terminal. As you progress through the tutorial,
                        you'll see commands and their output appear there. <strong>You should follow along
                        in your real terminal!</strong>
                    </p>
                </div>

                <!-- Step 1: Bootstrap -->
                <div class="step" data-step="1">
                    <span class="step-number">Step 1</span>
                    <h2>Bootstrap MELVIN</h2>
                    <p>
                        Every tetra session starts the same way: source the tetra environment.
                        This sets up all the strong globals (like <code>TETRA_SRC</code> and <code>TETRA_DIR</code>)
                        that modules depend on.
                    </p>

                    <div class="you-try">
                        <div class="you-try-header">You Try</div>
                        <p>In your terminal, navigate to the tetra directory and source tetra.sh:</p>
                        <div class="command-hint">cd ~/tetra<br>source ~/tetra/tetra.sh</div>
                    </div>

                    <p>
                        Now that tetra is loaded, let's load MELVIN. MELVIN is itself a tetra module,
                        so we source its includes.sh file.
                    </p>

                    <div class="you-try">
                        <div class="you-try-header">You Try</div>
                        <p>Load MELVIN:</p>
                        <div class="command-hint">source "$TETRA_SRC/bash/melvin/includes.sh"</div>
                    </div>

                    <div class="learn-box">
                        <div class="learn-box-header">What Just Happened?</div>
                        <ul>
                            <li><code>TETRA_SRC</code> points to your tetra source code</li>
                            <li><code>TETRA_DIR</code> points to runtime data (separate from code!)</li>
                            <li>MELVIN auto-detected the "tetra" context</li>
                            <li>Tetra-specific knowledge loaded automatically</li>
                        </ul>
                    </div>
                </div>

                <!-- Step 2: Health Check -->
                <div class="step" data-step="2">
                    <span class="step-number">Step 2</span>
                    <h2>Understand Current Architecture</h2>
                    <p>
                        Before building anything new, let's understand what's already there.
                        MELVIN's <code>health summary</code> command classifies all modules in the codebase.
                    </p>

                    <div class="you-try">
                        <div class="you-try-header">You Try</div>
                        <p>Run the health check:</p>
                        <div class="command-hint">melvin health summary</div>
                    </div>

                    <div class="learn-box">
                        <div class="learn-box-header">Understanding Module Types</div>
                        <p>MELVIN classifies modules into four types:</p>
                        <ul>
                            <li><strong>LIBRARY</strong>: Has only includes.sh (provides functions, no CLI)</li>
                            <li><strong>MODULE</strong>: Has actions.sh (provides user commands)</li>
                            <li><strong>APP</strong>: Has *_tui.sh (provides TUI interface)</li>
                            <li><strong>APP+MODULE</strong>: Has both actions and TUI</li>
                        </ul>
                    </div>

                    <p>
                        We're going to build a MODULE - something with user-facing commands for managing developer notes.
                    </p>
                </div>

                <!-- Step 3: Learn Concepts -->
                <div class="step" data-step="3">
                    <span class="step-number">Step 3</span>
                    <h2>Learn the Tetra Way</h2>
                    <p>
                        Tetra has strong opinions about how modules should be structured. These aren't arbitrary rules -
                        they ensure consistency, testability, and maintainability.
                    </p>

                    <div class="you-try">
                        <div class="you-try-header">You Try</div>
                        <p>List all available concepts:</p>
                        <div class="command-hint">melvin concepts</div>
                    </div>

                    <p>
                        You'll see concepts like <code>strong_globals</code>, <code>no_dotfiles</code>,
                        <code>lazy_loading</code>, and more. These are the patterns you need to follow.
                    </p>

                    <div class="learn-box">
                        <div class="learn-box-header">Key Concepts Preview</div>
                        <ul>
                            <li><strong>strong_globals</strong>: Every module declares MOD_SRC and MOD_DIR</li>
                            <li><strong>no_dotfiles</strong>: NEVER use hidden config files</li>
                            <li><strong>dual_directory</strong>: Code in TETRA_SRC, data in TETRA_DIR</li>
                            <li><strong>module_structure</strong>: Standard file layout</li>
                        </ul>
                    </div>
                </div>

                <!-- Step 4: Deep Dive -->
                <div class="step" data-step="4">
                    <span class="step-number">Step 4</span>
                    <h2>Deep Dive: Strong Globals</h2>
                    <p>
                        The most important pattern is <strong>strong_globals</strong>. Let's understand it deeply
                        because you'll use it in every module you build.
                    </p>

                    <div class="you-try">
                        <div class="you-try-header">You Try</div>
                        <p>Get detailed explanation:</p>
                        <div class="command-hint">melvin concepts strong_globals</div>
                    </div>

                    <p>
                        MELVIN will show you:
                    </p>
                    <ul style="margin-left: 2rem; margin-bottom: 1rem;">
                        <li>Why TETRA_SRC must always be set</li>
                        <li>The pattern: <code>: "${MOD_SRC:=$TETRA_SRC/bash/modname}"</code></li>
                        <li>Real examples from the codebase</li>
                        <li>Why we separate source (MOD_SRC) from data (MOD_DIR)</li>
                    </ul>

                    <div class="learn-box">
                        <div class="learn-box-header">The Pattern You'll Use</div>
                        <p>For our notes module, we'll write:</p>
                        <code style="display: block; padding: 1rem; background: rgba(0,0,0,0.2); border-radius: 4px; white-space: pre;">: "${NOTES_SRC:=$TETRA_SRC/bash/notes}"
: "${NOTES_DIR:=$TETRA_DIR/notes}"
export NOTES_SRC NOTES_DIR</code>
                    </div>
                </div>

                <!-- Step 5: Study Example -->
                <div class="step" data-step="5">
                    <span class="step-number">Step 5</span>
                    <h2>Study a Similar Module</h2>
                    <p>
                        Learning by example is powerful. Let's look at the RAG module -
                        it's a well-structured MODULE that we can learn from.
                    </p>

                    <div class="you-try">
                        <div class="you-try-header">You Try</div>
                        <p>Get detailed analysis of the RAG module:</p>
                        <div class="command-hint">melvin explain rag</div>
                    </div>

                    <p>
                        MELVIN shows you everything about the module:
                    </p>
                    <ul style="margin-left: 2rem; margin-bottom: 1rem;">
                        <li>Its classification (MODULE)</li>
                        <li>Which strong globals it defines (RAG_SRC, RAG_DIR)</li>
                        <li>What functions it exports</li>
                        <li>Whether it's registered in the boot system</li>
                        <li>Lines of code and last modification date</li>
                    </ul>

                    <div class="learn-box">
                        <div class="learn-box-header">Module Anatomy</div>
                        <p>Notice the RAG module has:</p>
                        <ul>
                            <li><strong>includes.sh</strong>: Entry point, defines globals</li>
                            <li><strong>rag.sh</strong>: Core functions</li>
                            <li><strong>actions.sh</strong>: CLI interface (makes it a MODULE)</li>
                            <li><strong>rag_repl.sh</strong>: Optional interactive mode</li>
                        </ul>
                    </div>
                </div>

                <!-- Step 6: Create Structure -->
                <div class="step" data-step="6">
                    <span class="step-number">Step 6</span>
                    <h2>Create the Module Structure</h2>
                    <p>
                        Now you know the patterns. Let's create our <code>notes</code> module.
                        We'll start with the directory and the most important file: <code>includes.sh</code>
                    </p>

                    <div class="you-try">
                        <div class="you-try-header">You Try</div>
                        <p>Create the module directory:</p>
                        <div class="command-hint">mkdir -p "$TETRA_SRC/bash/notes"</div>
                    </div>

                    <p>
                        Now create <code>includes.sh</code> - this is your module's entry point.
                        It must define strong globals and source the core file.
                    </p>

                    <div class="you-try">
                        <div class="you-try-header">You Try</div>
                        <p>Create includes.sh with strong globals pattern:</p>
                        <div class="command-hint" style="font-size: 0.8rem;">cat &gt; "$TETRA_SRC/bash/notes/includes.sh" &lt;&lt;'EOF'<br>
#!/usr/bin/env bash<br>
<br>
: "${NOTES_SRC:=$TETRA_SRC/bash/notes}"<br>
: "${NOTES_DIR:=$TETRA_DIR/notes}"<br>
export NOTES_SRC NOTES_DIR<br>
<br>
source "$NOTES_SRC/notes.sh"<br>
EOF</div>
                    </div>
                </div>

                <!-- Step 7: Core Functions -->
                <div class="step" data-step="7">
                    <span class="step-number">Step 7</span>
                    <h2>Add Core Functions</h2>
                    <p>
                        The <code>notes.sh</code> file contains your module's core logic.
                        We'll keep it simple but functional.
                    </p>

                    <div class="you-try">
                        <div class="you-try-header">You Try</div>
                        <p>Create notes.sh with basic functions:</p>
                        <div class="command-hint" style="font-size: 0.8rem;">cat &gt; "$TETRA_SRC/bash/notes/notes.sh" &lt;&lt;'EOF'<br>
#!/usr/bin/env bash<br>
<br>
notes_init() {<br>
&nbsp;&nbsp;mkdir -p "$NOTES_DIR"<br>
&nbsp;&nbsp;echo "Notes initialized at: $NOTES_DIR"<br>
}<br>
<br>
notes_add() {<br>
&nbsp;&nbsp;local note="$1"<br>
&nbsp;&nbsp;local timestamp=$(date +"%Y-%m-%d %H:%M:%S")<br>
&nbsp;&nbsp;echo "[$timestamp $note" &gt;&gt; "$NOTES_DIR/notes.log"<br>
&nbsp;&nbsp;echo "Note added."<br>
}<br>
<br>
notes_list() {<br>
&nbsp;&nbsp;[[ -f "$NOTES_DIR/notes.log"  && cat "$NOTES_DIR/notes.log"<br>
}<br>
<br>
export -f notes_init notes_add notes_list<br>
EOF</div>
                    </div>

                    <div class="learn-box">
                        <div class="learn-box-header">Notice the Pattern</div>
                        <ul>
                            <li>Functions prefixed with module name: <code>notes_*</code></li>
                            <li>Data stored in <code>$NOTES_DIR</code> (not in source!)</li>
                            <li>Functions exported with <code>export -f</code></li>
                        </ul>
                    </div>
                </div>

                <!-- Step 8: Actions Interface -->
                <div class="step" data-step="8">
                    <span class="step-number">Step 8</span>
                    <h2>Add Actions Interface</h2>
                    <p>
                        The <code>actions.sh</code> file is what makes this a MODULE.
                        It provides the user-facing CLI interface.
                    </p>

                    <div class="you-try">
                        <div class="you-try-header">You Try</div>
                        <p>Create actions.sh with command dispatcher:</p>
                        <div class="command-hint" style="font-size: 0.75rem;">cat &gt; "$TETRA_SRC/bash/notes/actions.sh" &lt;&lt;'EOF'<br>
#!/usr/bin/env bash<br>
<br>
notes() {<br>
&nbsp;&nbsp;local action="${1:-list}"<br>
&nbsp;&nbsp;shift || true<br>
&nbsp;&nbsp;case "$action" in<br>
&nbsp;&nbsp;&nbsp;&nbsp;init) notes_init "$@" ;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;add|a) notes_add "$@" ;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;list|l) notes_list "$@" ;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;help|h) echo "Usage: notes {init|add|list}" ;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;*) echo "Unknown: $action"; return 1 ;;<br>
&nbsp;&nbsp;esac<br>
}<br>
export -f notes<br>
EOF</div>
                    </div>

                    <p>
                        Make the files executable:
                    </p>

                    <div class="you-try">
                        <div class="you-try-header">You Try</div>
                        <div class="command-hint">chmod +x "$TETRA_SRC/bash/notes"/*.sh</div>
                    </div>
                </div>

                <!-- Step 9: Verify -->
                <div class="step" data-step="9">
                    <span class="step-number">Step 9</span>
                    <h2>Verify with MELVIN</h2>
                    <p>
                        Now for the moment of truth! Let's see if MELVIN recognizes our module
                        as a proper MODULE.
                    </p>

                    <div class="you-try">
                        <div class="you-try-header">You Try</div>
                        <p>Classify your new module:</p>
                        <div class="command-hint">melvin classify notes</div>
                    </div>

                    <p>
                        MELVIN should classify it as a MODULE because it found <code>includes.sh</code>
                        and <code>actions.sh</code>. Success!
                    </p>

                    <p>
                        Now let's get a detailed health report:
                    </p>

                    <div class="you-try">
                        <div class="you-try-header">You Try</div>
                        <p>Get health check for notes module:</p>
                        <div class="command-hint">melvin health notes</div>
                    </div>

                    <div class="learn-box">
                        <div class="learn-box-header">MELVIN's Recommendations</div>
                        <p>MELVIN might suggest:</p>
                        <ul>
                            <li>Add README.md for documentation</li>
                            <li>Register in boot_modules.sh for lazy loading</li>
                            <li>Consider adding notes_repl.sh for interactive mode</li>
                        </ul>
                    </div>
                </div>

                <!-- Step 10: Test -->
                <div class="step" data-step="10">
                    <span class="step-number">Step 10</span>
                    <h2>Test Your Module</h2>
                    <p>
                        Let's actually use the module! First, source it to make it available:
                    </p>

                    <div class="you-try">
                        <div class="you-try-header">You Try</div>
                        <p>Load your module:</p>
                        <div class="command-hint">source "$TETRA_SRC/bash/notes/includes.sh"</div>
                    </div>

                    <p>
                        Now initialize the notes system:
                    </p>

                    <div class="you-try">
                        <div class="you-try-header">You Try</div>
                        <div class="command-hint">notes init</div>
                    </div>

                    <p>
                        Add your first note:
                    </p>

                    <div class="you-try">
                        <div class="you-try-header">You Try</div>
                        <div class="command-hint">notes add "MELVIN helped me build this the tetra way!"</div>
                    </div>

                    <p>
                        List your notes:
                    </p>

                    <div class="you-try">
                        <div class="you-try-header">You Try</div>
                        <div class="command-hint">notes list</div>
                    </div>

                    <div class="learn-box">
                        <div class="learn-box-header">It Works!</div>
                        <p>Your module is fully functional and follows all tetra patterns:</p>
                        <ul>
                            <li>‚úì Strong globals (NOTES_SRC, NOTES_DIR)</li>
                            <li>‚úì Dual directory (code vs data separation)</li>
                            <li>‚úì Module structure (includes.sh, notes.sh, actions.sh)</li>
                            <li>‚úì Proper classification (MODULE type)</li>
                        </ul>
                    </div>
                </div>

                <!-- Step 11: Conclusion -->
                <div class="step" data-step="11">
                    <span class="step-number">Conclusion</span>
                    <h2>You've Learned the Tetra Way!</h2>
                    <p>
                        Congratulations! You've successfully built a tetra module using MELVIN as your guide.
                    </p>

                    <div class="learn-box">
                        <div class="learn-box-header">What You Mastered</div>
                        <ul>
                            <li><strong>Strong Globals</strong>: MOD_SRC and MOD_DIR pattern</li>
                            <li><strong>Module Types</strong>: Understanding LIBRARY vs MODULE vs APP</li>
                            <li><strong>File Structure</strong>: includes.sh, core.sh, actions.sh</li>
                            <li><strong>MELVIN Commands</strong>: health, explain, classify, concepts</li>
                            <li><strong>Tetra Philosophy</strong>: No dotfiles, dual directories, explicit exports</li>
                        </ul>
                    </div>

                    <h3 style="margin-top: 2rem; margin-bottom: 1rem;">Next Steps</h3>
                    <p>Take your module further:</p>
                    <ul style="margin-left: 2rem; margin-bottom: 1rem;">
                        <li>Add <code>notes_repl.sh</code> for interactive mode</li>
                        <li>Create <code>README.md</code> documentation</li>
                        <li>Register in <code>bash/boot/boot_modules.sh</code> for lazy loading</li>
                        <li>Add tests in <code>tests/</code> directory</li>
                    </ul>

                    <h3 style="margin-top: 2rem; margin-bottom: 1rem;">Keep Learning with MELVIN</h3>

                    <div class="you-try">
                        <div class="you-try-header">Explore More</div>
                        <p>Try these MELVIN commands:</p>
                        <div class="command-hint">melvin repl           # Interactive exploration<br>
melvin stats          # Your learning progress<br>
melvin concepts       # Review all patterns<br>
melvin list MODULE    # See all modules</div>
                    </div>

                    <p style="margin-top: 2rem; text-align: center; font-weight: bold; color: #667eea;">
                        MELVIN: Machine Electronics Live Virtual Intelligence Network<br>
                        <em style="font-weight: normal; font-size: 0.9rem;">Precision above all. üéØ</em>
                    </p>
                </div>

            </div>
        </div>

        <!-- Terminal Panel (Right) -->
        <div class="panel terminal-panel">
            <div class="panel-header">Terminal Output</div>
            <div class="terminal-window">
                <div class="terminal-titlebar">
                    <div class="terminal-dot dot-red"></div>
                    <div class="terminal-dot dot-yellow"></div>
                    <div class="terminal-dot dot-green"></div>
                    <div class="terminal-title">bash - melvin-tutorial</div>
                </div>
                <div class="terminal-content" id="terminal">
                    <!-- Terminal content will be populated by JavaScript -->
                </div>
            </div>
        </div>
    </div>

    <!-- Design Token FAB -->
    <button class="design-fab" onclick="toggleDesignPanel()" id="designFab">
        ‚öô
    </button>

    <div class="design-panel" id="designPanel">
        <div class="design-panel-header">
            <span>Design Tokens</span>
            <span class="design-panel-close" onclick="toggleDesignPanel()">√ó</span>
        </div>
        <div class="design-panel-content">
            <div class="token-group">
                <div class="token-group-title">Background</div>
                <div class="token-item">
                    <input type="color" class="token-picker" value="#0d1117" onchange="updateToken('--bg-primary', this.value)">
                    <div class="token-swatch" style="background: var(--bg-primary)"></div>
                    <div class="token-info">
                        <div class="token-name">--bg-primary</div>
                        <div class="token-value" id="token-bg-primary">#0d1117</div>
                    </div>
                </div>
                <div class="token-item">
                    <input type="color" class="token-picker" value="#161b22" onchange="updateToken('--bg-secondary', this.value)">
                    <div class="token-swatch" style="background: var(--bg-secondary)"></div>
                    <div class="token-info">
                        <div class="token-name">--bg-secondary</div>
                        <div class="token-value" id="token-bg-secondary">#161b22</div>
                    </div>
                </div>
                <div class="token-item">
                    <input type="color" class="token-picker" value="#21262d" onchange="updateToken('--bg-tertiary', this.value)">
                    <div class="token-swatch" style="background: var(--bg-tertiary)"></div>
                    <div class="token-info">
                        <div class="token-name">--bg-tertiary</div>
                        <div class="token-value" id="token-bg-tertiary">#21262d</div>
                    </div>
                </div>
            </div>

            <div class="token-group">
                <div class="token-group-title">Text</div>
                <div class="token-item">
                    <input type="color" class="token-picker" value="#c9d1d9" onchange="updateToken('--text-primary', this.value)">
                    <div class="token-swatch" style="background: var(--text-primary)"></div>
                    <div class="token-info">
                        <div class="token-name">--text-primary</div>
                        <div class="token-value" id="token-text-primary">#c9d1d9</div>
                    </div>
                </div>
                <div class="token-item">
                    <input type="color" class="token-picker" value="#8b949e" onchange="updateToken('--text-secondary', this.value)">
                    <div class="token-swatch" style="background: var(--text-secondary)"></div>
                    <div class="token-info">
                        <div class="token-name">--text-secondary</div>
                        <div class="token-value" id="token-text-secondary">#8b949e</div>
                    </div>
                </div>
            </div>

            <div class="token-group">
                <div class="token-group-title">Accent</div>
                <div class="token-item">
                    <input type="color" class="token-picker" value="#58a6ff" onchange="updateToken('--accent-primary', this.value)">
                    <div class="token-swatch" style="background: var(--accent-primary)"></div>
                    <div class="token-info">
                        <div class="token-name">--accent-primary</div>
                        <div class="token-value" id="token-accent-primary">#58a6ff</div>
                    </div>
                </div>
                <div class="token-item">
                    <input type="color" class="token-picker" value="#1f6feb" onchange="updateToken('--accent-secondary', this.value)">
                    <div class="token-swatch" style="background: var(--accent-secondary)"></div>
                    <div class="token-info">
                        <div class="token-name">--accent-secondary</div>
                        <div class="token-value" id="token-accent-secondary">#1f6feb</div>
                    </div>
                </div>
            </div>

            <div class="token-group">
                <div class="token-group-title">Status</div>
                <div class="token-item">
                    <input type="color" class="token-picker" value="#3fb950" onchange="updateToken('--success', this.value)">
                    <div class="token-swatch" style="background: var(--success)"></div>
                    <div class="token-info">
                        <div class="token-name">--success</div>
                        <div class="token-value" id="token-success">#3fb950</div>
                    </div>
                </div>
                <div class="token-item">
                    <input type="color" class="token-picker" value="#d29922" onchange="updateToken('--warning', this.value)">
                    <div class="token-swatch" style="background: var(--warning)"></div>
                    <div class="token-info">
                        <div class="token-name">--warning</div>
                        <div class="token-value" id="token-warning">#d29922</div>
                    </div>
                </div>
                <div class="token-item">
                    <input type="color" class="token-picker" value="#f85149" onchange="updateToken('--error', this.value)">
                    <div class="token-swatch" style="background: var(--error)"></div>
                    <div class="token-info">
                        <div class="token-name">--error</div>
                        <div class="token-value" id="token-error">#f85149</div>
                    </div>
                </div>
            </div>

            <div class="token-group">
                <div class="token-group-title">Border</div>
                <div class="token-item">
                    <input type="color" class="token-picker" value="#30363d" onchange="updateToken('--border', this.value)">
                    <div class="token-swatch" style="background: var(--border)"></div>
                    <div class="token-info">
                        <div class="token-name">--border</div>
                        <div class="token-value" id="token-border">#30363d</div>
                    </div>
                </div>
            </div>

            <div class="token-group">
                <div class="token-group-title">Fonts</div>

                <div style="margin-bottom: 1rem; padding: 0.75rem; background: var(--bg-primary); border-radius: 4px; border: 1px solid var(--border);">
                    <label style="font-size: 0.75rem; color: var(--text-secondary); display: block; margin-bottom: 0.5rem;">Add Google Font</label>
                    <input type="text" class="font-input" id="fontCdnUrl" placeholder="https://fonts.googleapis.com/css2?family=...">
                    <input type="text" class="font-input" id="fontFamily" placeholder="'Font Name', sans-serif">
                    <button class="add-font-btn" onclick="addCustomFont()">Add Font to Page</button>

                    <div class="font-example-toggle" onclick="toggleFontExample()">
                        ‚ñ∏ Show example
                    </div>

                    <div class="font-example-content" id="fontExampleContent">
                        <strong>Example: Science Gothic</strong>
                        <ol>
                            <li>Visit <a href="https://fonts.google.com/specimen/Science+Gothic" target="_blank" style="color: var(--accent-primary);">fonts.google.com/specimen/Science+Gothic</a></li>
                            <li>Click <strong>"Get font"</strong> button (top right)</li>
                            <li>Click <strong>"Get embed code"</strong> in the sidebar</li>
                            <li>Copy the URL from the <code>&lt;link&gt;</code> tag:<br>
                                <code style="display: block; margin-top: 0.25rem; word-break: break-all;">https://fonts.googleapis.com/css2?family=Science+Gothic:ital,wght@0,300;0,400;0,700;1,300;1,400;1,700&display=swap</code>
                            </li>
                            <li>Copy the CSS font-family value:<br>
                                <code style="display: block; margin-top: 0.25rem;">"Science Gothic", sans-serif</code>
                            </li>
                            <li>Paste both values into the fields above</li>
                            <li>Click "Add Font to Page"</li>
                            <li>Select "Science Gothic (Custom)" from any dropdown</li>
                        </ol>
                    </div>
                </div>

                <div style="margin-bottom: 0.75rem;">
                    <label style="font-size: 0.75rem; color: var(--text-secondary); display: block; margin-bottom: 0.25rem;">Heading Font</label>
                    <select class="font-select" onchange="updateFont('heading', this.value)" id="headingFont">
                        <option value="-apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif">System (Default)</option>
                        <option value="'Courier New', monospace">Courier New</option>
                        <option value="Monaco, monospace">Monaco</option>
                        <option value="'SF Mono', monospace">SF Mono</option>
                        <option value="'Roboto Mono', monospace">Roboto Mono</option>
                        <option value="Georgia, serif">Georgia</option>
                        <option value="'Times New Roman', serif">Times New Roman</option>
                    </select>
                </div>
                <div style="margin-bottom: 0.75rem;">
                    <label style="font-size: 0.75rem; color: var(--text-secondary); display: block; margin-bottom: 0.25rem;">Body Font</label>
                    <select class="font-select" onchange="updateFont('body', this.value)" id="bodyFont">
                        <option value="-apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif">System (Default)</option>
                        <option value="'Courier New', monospace">Courier New</option>
                        <option value="Monaco, monospace">Monaco</option>
                        <option value="'SF Mono', monospace">SF Mono</option>
                        <option value="'Roboto Mono', monospace">Roboto Mono</option>
                        <option value="Georgia, serif">Georgia</option>
                        <option value="Arial, sans-serif">Arial</option>
                    </select>
                </div>
                <div>
                    <label style="font-size: 0.75rem; color: var(--text-secondary); display: block; margin-bottom: 0.25rem;">Code Font</label>
                    <select class="font-select" onchange="updateFont('code', this.value)" id="codeFont">
                        <option value="'Courier New', Monaco, monospace">Courier New (Default)</option>
                        <option value="Monaco, monospace">Monaco</option>
                        <option value="'SF Mono', monospace">SF Mono</option>
                        <option value="'Roboto Mono', monospace">Roboto Mono</option>
                        <option value="Consolas, monospace">Consolas</option>
                        <option value="'Fira Code', monospace">Fira Code</option>
                    </select>
                </div>
            </div>

            <div class="design-panel-buttons">
                <button class="design-panel-btn copy-tokens-btn" onclick="copyTokens()" id="copyTokensBtn">
                    Copy CSS
                </button>
                <button class="design-panel-btn copy-tokens-btn" onclick="loadTokens()" id="loadTokensBtn" style="background: var(--bg-tertiary); border-color: var(--border); color: var(--text-primary);">
                    Load CSS
                </button>
                <button class="design-panel-btn reset-tokens-btn" onclick="resetTokens()" id="resetTokensBtn">
                    Reset
                </button>
            </div>
        </div>
    </div>

    <script>
        let currentStep = 0;
        const totalSteps = 11;

        // Terminal content for each step
        const terminalContent = {
            0: [
                { type: 'comment', text: '# Welcome! Ready to learn the tetra way?' },
                { type: 'comment', text: '# Keep this browser tab open alongside your terminal' },
                { type: 'comment', text: '# Click "Next" when ready to begin' }
            ],
            1: [
                { type: 'prompt', text: '$ ', inline: true },
                { type: 'command', text: 'cd ~/tetra' },
                { type: 'prompt', text: '$ ', inline: true },
                { type: 'command', text: 'source ~/tetra/tetra.sh' },
                { type: 'output-success', text: '‚úì Tetra initialized' },
                { type: 'output', text: 'TETRA_SRC=/Users/you/tetra' },
                { type: 'output', text: 'TETRA_DIR=/Users/you/tetra_dir' },
                { type: 'blank' },
                { type: 'prompt', text: '$ ', inline: true },
                { type: 'command', text: 'source "$TETRA_SRC/bash/melvin/includes.sh"' },
                { type: 'output-success', text: '‚úì MELVIN loaded' },
                { type: 'output', text: 'Context: tetra' },
                { type: 'output', text: 'Root: /Users/you/tetra' }
            ],
            2: [
                { type: 'prompt', text: '$ ', inline: true },
                { type: 'command', text: 'melvin health summary' },
                { type: 'blank' },
                { type: 'output-header', text: 'MELVIN Health Summary' },
                { type: 'output-header', text: '=====================' },
                { type: 'output', text: 'Modules found in: /Users/you/tetra/bash' },
                { type: 'blank' },
                { type: 'output', text: 'Type Counts:' },
                { type: 'output-success', text: '  LIBRARY:      8 modules' },
                { type: 'output-success', text: '  MODULE:      12 modules (with actions.sh)' },
                { type: 'output-success', text: '  APP:          3 modules (with TUI)' },
                { type: 'output-success', text: '  APP+MODULE:   2 modules' },
                { type: 'output-warning', text: '  UNKNOWN:      1 directories' },
                { type: 'blank' },
                { type: 'output', text: 'Total: 26 directories classified' }
            ],
            3: [
                { type: 'prompt', text: '$ ', inline: true },
                { type: 'command', text: 'melvin concepts' },
                { type: 'blank' },
                { type: 'output-header', text: 'Available Concepts:' },
                { type: 'output-header', text: '===================' },
                { type: 'blank' },
                { type: 'output', text: 'strong_globals        - TETRA_SRC must always be set...' },
                { type: 'output', text: 'no_dotfiles          - NEVER use . (dot) files in tetra...' },
                { type: 'output', text: 'lazy_loading         - Modules registered but not loaded...' },
                { type: 'output', text: 'dual_directory       - Code vs data separation...' },
                { type: 'output', text: 'includes_guard       - Override guards pattern...' },
                { type: 'output', text: 'module_types         - LIBRARY, MODULE, APP, APP+MODULE' },
                { type: 'output', text: 'boot_chain           - Bootstrap sequence...' },
                { type: 'output', text: 'bash_version         - Tetra ALWAYS runs in bash 5.2+...' },
                { type: 'output', text: 'module_structure     - Standard file layout...' },
                { type: 'output', text: 'tetra_self           - Introspection module...' }
            ],
            4: [
                { type: 'prompt', text: '$ ', inline: true },
                { type: 'command', text: 'melvin concepts strong_globals' },
                { type: 'blank' },
                { type: 'output-header', text: 'Concept: strong_globals' },
                { type: 'output-header', text: '‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ' },
                { type: 'blank' },
                { type: 'output', text: 'TETRA_SRC is the bedrock - it MUST be set for anything to work.' },
                { type: 'blank' },
                { type: 'output', text: 'Every module follows this pattern:' },
                { type: 'output', text: '  : "${MOD_SRC:=$TETRA_SRC/bash/modname}"', highlight: true },
                { type: 'output', text: '  : "${MOD_DIR:=$TETRA_DIR/modname}"', highlight: true },
                { type: 'output', text: '  export MOD_SRC MOD_DIR', highlight: true },
                { type: 'blank' },
                { type: 'output', text: 'Why?' },
                { type: 'output', text: '  ‚Ä¢ MOD_SRC = source code (read-only, in git)' },
                { type: 'output', text: '  ‚Ä¢ MOD_DIR = runtime data (read-write, ephemeral)' },
                { type: 'blank' },
                { type: 'output', text: 'Examples from codebase:' },
                { type: 'output-success', text: '  ‚Ä¢ bash/rag/includes.sh:7' },
                { type: 'output-success', text: '  ‚Ä¢ bash/melvin/includes.sh:9' },
                { type: 'output-success', text: '  ‚Ä¢ bash/chroma/includes.sh:5' }
            ],
            5: [
                { type: 'prompt', text: '$ ', inline: true },
                { type: 'command', text: 'melvin explain rag' },
                { type: 'blank' },
                { type: 'output-header', text: 'bash/rag: MODULE' },
                { type: 'output', text: '  Has actions.sh (with REPL)' },
                { type: 'blank' },
                { type: 'output', text: 'Description:' },
                { type: 'output', text: '  RAG (Retrieval-Augmented Generation) system' },
                { type: 'blank' },
                { type: 'output', text: 'Features: includes actions repl' },
                { type: 'output-success', text: 'Strong globals: RAG_SRC RAG_DIR ‚úì' },
                { type: 'output', text: 'Exported functions:' },
                { type: 'output', text: '  - rag_repl' },
                { type: 'output', text: '  - tetra_rag_search' },
                { type: 'output', text: '  - tetra_rag_chunks' },
                { type: 'blank' },
                { type: 'output', text: 'LOC: ~2500 lines' },
                { type: 'output', text: 'Last modified: 2025-11-21' },
                { type: 'output-success', text: 'Registered: ‚úì boot_modules.sh:44' }
            ],
            6: [
                { type: 'prompt', text: '$ ', inline: true },
                { type: 'command', text: 'mkdir -p "$TETRA_SRC/bash/notes"' },
                { type: 'blank' },
                { type: 'prompt', text: '$ ', inline: true },
                { type: 'command', text: 'cat > "$TETRA_SRC/bash/notes/includes.sh" <<\'EOF\'' },
                { type: 'output', text: '#!/usr/bin/env bash' },
                { type: 'output', text: '' },
                { type: 'output', text: ': "${NOTES_SRC:=$TETRA_SRC/bash/notes}"', highlight: true },
                { type: 'output', text: ': "${NOTES_DIR:=$TETRA_DIR/notes}"', highlight: true },
                { type: 'output', text: 'export NOTES_SRC NOTES_DIR', highlight: true },
                { type: 'output', text: '' },
                { type: 'output', text: 'source "$NOTES_SRC/notes.sh"' },
                { type: 'output', text: 'EOF' },
                { type: 'blank' },
                { type: 'output-success', text: '‚úì includes.sh created with strong globals pattern' }
            ],
            7: [
                { type: 'prompt', text: '$ ', inline: true },
                { type: 'command', text: 'cat > "$TETRA_SRC/bash/notes/notes.sh" <<\'EOF\'' },
                { type: 'output', text: '#!/usr/bin/env bash' },
                { type: 'output', text: '' },
                { type: 'output', text: 'notes_init() {' },
                { type: 'output', text: '  mkdir -p "$NOTES_DIR"', highlight: true },
                { type: 'output', text: '  echo "Notes initialized at: $NOTES_DIR"' },
                { type: 'output', text: '}' },
                { type: 'output', text: '' },
                { type: 'output', text: 'notes_add() {' },
                { type: 'output', text: '  local timestamp=$(date +"%Y-%m-%d %H:%M:%S")' },
                { type: 'output', text: '  echo "[$timestamp $1" >> "$NOTES_DIR/notes.log"', highlight: true },
                { type: 'output', text: '}' },
                { type: 'output', text: '' },
                { type: 'output', text: 'export -f notes_init notes_add notes_list', highlight: true },
                { type: 'output', text: 'EOF' }
            ],
            8: [
                { type: 'prompt', text: '$ ', inline: true },
                { type: 'command', text: 'cat > "$TETRA_SRC/bash/notes/actions.sh" <<\'EOF\'' },
                { type: 'output', text: '#!/usr/bin/env bash' },
                { type: 'output', text: '' },
                { type: 'output', text: 'notes() {', highlight: true },
                { type: 'output', text: '  local action="${1:-list}"' },
                { type: 'output', text: '  shift || true' },
                { type: 'output', text: '  case "$action" in' },
                { type: 'output', text: '    init) notes_init "$@" ;;' },
                { type: 'output', text: '    add|a) notes_add "$@" ;;' },
                { type: 'output', text: '    list|l) notes_list "$@" ;;' },
                { type: 'output', text: '    *) echo "Unknown: $action"; return 1 ;;' },
                { type: 'output', text: '  esac' },
                { type: 'output', text: '}' },
                { type: 'output', text: 'EOF' },
                { type: 'blank' },
                { type: 'prompt', text: '$ ', inline: true },
                { type: 'command', text: 'chmod +x "$TETRA_SRC/bash/notes"/*.sh' },
                { type: 'output-success', text: '‚úì Module structure complete!' }
            ],
            9: [
                { type: 'prompt', text: '$ ', inline: true },
                { type: 'command', text: 'melvin classify notes' },
                { type: 'blank' },
                { type: 'output-header', text: 'bash/notes: MODULE' },
                { type: 'blank' },
                { type: 'output', text: 'Classification reasoning:' },
                { type: 'output-success', text: '  ‚úì Has includes.sh' },
                { type: 'output-success', text: '  ‚úì Has actions.sh' },
                { type: 'output', text: '  ‚óã No REPL file (*_repl.sh)' },
                { type: 'output', text: '  ‚óã No TUI file (*_tui.sh)' },
                { type: 'blank' },
                { type: 'output-success', text: 'Type: MODULE ‚úì' },
                { type: 'blank' },
                { type: 'prompt', text: '$ ', inline: true },
                { type: 'command', text: 'melvin health notes' },
                { type: 'blank' },
                { type: 'output-success', text: 'Strong globals: NOTES_SRC NOTES_DIR ‚úì' },
                { type: 'output-warning', text: 'Boot registered: ‚úó (not in boot_modules.sh)' },
                { type: 'output', text: 'Recommendations:' },
                { type: 'output', text: '  ‚Ä¢ Add README.md' },
                { type: 'output', text: '  ‚Ä¢ Register in boot_modules.sh' }
            ],
            10: [
                { type: 'prompt', text: '$ ', inline: true },
                { type: 'command', text: 'source "$TETRA_SRC/bash/notes/includes.sh"' },
                { type: 'output-success', text: '‚úì Module loaded' },
                { type: 'blank' },
                { type: 'prompt', text: '$ ', inline: true },
                { type: 'command', text: 'notes init' },
                { type: 'output', text: 'Notes initialized at: /Users/you/tetra_dir/notes' },
                { type: 'blank' },
                { type: 'prompt', text: '$ ', inline: true },
                { type: 'command', text: 'notes add "MELVIN helped me build this the tetra way!"' },
                { type: 'output-success', text: 'Note added.' },
                { type: 'blank' },
                { type: 'prompt', text: '$ ', inline: true },
                { type: 'command', text: 'notes list' },
                { type: 'output', text: '[2025-11-21 14:30:00 MELVIN helped me build this the tetra way!', highlight: true },
                { type: 'blank' },
                { type: 'output-success', text: '‚úì Module works perfectly!' }
            ],
            11: [
                { type: 'output-header', text: 'Congratulations!' },
                { type: 'blank' },
                { type: 'output-success', text: 'You built a complete tetra module following all patterns:' },
                { type: 'output-success', text: '  ‚úì Strong globals (NOTES_SRC, NOTES_DIR)' },
                { type: 'output-success', text: '  ‚úì Module structure (includes.sh, notes.sh, actions.sh)' },
                { type: 'output-success', text: '  ‚úì Proper classification (MODULE type)' },
                { type: 'output-success', text: '  ‚úì Dual directory separation' },
                { type: 'output-success', text: '  ‚úì Function exports' },
                { type: 'blank' },
                { type: 'comment', text: '# Keep exploring with MELVIN:' },
                { type: 'prompt', text: '$ ', inline: true },
                { type: 'command', text: 'melvin repl' },
                { type: 'comment', text: '# Try other modules, learn more patterns!' },
                { type: 'blank' },
                { type: 'output', text: 'MELVIN: Machine Electronics Live Virtual Intelligence Network' },
                { type: 'output', text: 'Precision above all.' }
            ]
        };

        function renderTerminal(step) {
            const terminal = document.getElementById('terminal');
            terminal.innerHTML = '';

            const content = terminalContent[step] || [];

            content.forEach((line, index) => {
                setTimeout(() => {
                    const lineDiv = document.createElement('div');
                    lineDiv.className = `terminal-line ${line.type}`;

                    if (line.type === 'blank') {
                        lineDiv.innerHTML = '&nbsp;';
                    } else if (line.inline) {
                        const span = document.createElement('span');
                        span.textContent = line.text;
                        lineDiv.appendChild(span);
                        lineDiv.style.display = 'inline';
                    } else {
                        if (line.highlight) {
                            const span = document.createElement('span');
                            span.className = 'highlight';
                            span.textContent = line.text;
                            lineDiv.appendChild(span);
                        } else {
                            lineDiv.textContent = line.text;
                        }
                    }

                    terminal.appendChild(lineDiv);
                    lineDiv.classList.add('visible');

                    // Auto-scroll to bottom
                    terminal.scrollTop = terminal.scrollHeight;
                }, index * 100);
            });
        }

        function updateStep() {
            // Hide all steps
            document.querySelectorAll('.step').forEach(step => {
                step.classList.remove('active');
            });

            // Show current step
            const currentStepEl = document.querySelector(`[data-step="${currentStep}"]`);
            if (currentStepEl) {
                currentStepEl.classList.add('active');
            }

            // Update buttons
            document.getElementById('prevBtn').disabled = currentStep === 0;
            document.getElementById('nextBtn').disabled = currentStep === totalSteps;

            if (currentStep === totalSteps) {
                document.getElementById('nextBtn').textContent = '‚úì Complete';
            } else {
                document.getElementById('nextBtn').textContent = 'Next ‚Üí';
            }

            // Update progress
            document.getElementById('progress').textContent = `Step ${currentStep + 1} of ${totalSteps + 1}`;

            // Update terminal
            renderTerminal(currentStep);

            // Scroll to top
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function nextStep() {
            if (currentStep < totalSteps) {
                currentStep++;
                updateStep();
            }
        }

        function prevStep() {
            if (currentStep > 0) {
                currentStep--;
                updateStep();
            }
        }

        // Keyboard navigation
        document.addEventListener('keydown', (e) => {
            if (e.key === 'ArrowRight' && currentStep < totalSteps) {
                nextStep();
            } else if (e.key === 'ArrowLeft' && currentStep > 0) {
                prevStep();
            }
        });

        // Initialize
        updateStep();

        // Design Token Panel
        function toggleDesignPanel() {
            const panel = document.getElementById('designPanel');
            panel.classList.toggle('visible');
        }

        const defaultTokens = {
            '--bg-primary': '#0d1117',
            '--bg-secondary': '#161b22',
            '--bg-tertiary': '#21262d',
            '--text-primary': '#c9d1d9',
            '--text-secondary': '#8b949e',
            '--accent-primary': '#58a6ff',
            '--accent-secondary': '#1f6feb',
            '--success': '#3fb950',
            '--warning': '#d29922',
            '--error': '#f85149',
            '--border': '#30363d',
            '--highlight': '#388bfd26'
        };

        const defaultFonts = {
            heading: "-apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif",
            body: "-apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif",
            code: "'Courier New', Monaco, monospace"
        };

        function updateToken(tokenName, value) {
            document.documentElement.style.setProperty(tokenName, value);
            const displayId = 'token-' + tokenName.replace('--', '').replace(/-/g, '-');
            const displayEl = document.getElementById(displayId);
            if (displayEl) {
                displayEl.textContent = value;
            }

            // Update corresponding color picker
            const picker = document.querySelector(`input[onchange*="${tokenName}"]`);
            if (picker) {
                picker.value = value;
            }
        }

        function updateFont(type, font) {
            switch(type) {
                case 'heading':
                    document.querySelectorAll('h1, h2, h3, .step-number').forEach(el => {
                        el.style.fontFamily = font;
                    });
                    break;
                case 'body':
                    document.body.style.fontFamily = font;
                    break;
                case 'code':
                    document.querySelectorAll('code, .command-hint, .terminal-content, .token-name, .token-value').forEach(el => {
                        el.style.fontFamily = font;
                    });
                    break;
            }
        }

        function toggleFontExample() {
            const content = document.getElementById('fontExampleContent');
            const toggle = document.querySelector('.font-example-toggle');

            if (content.classList.contains('expanded')) {
                content.classList.remove('expanded');
                toggle.textContent = '‚ñ∏ Show example';
            } else {
                content.classList.add('expanded');
                toggle.textContent = '‚ñæ Hide example';
            }
        }

        function addCustomFont() {
            const cdnUrl = document.getElementById('fontCdnUrl').value.trim();
            const fontFamily = document.getElementById('fontFamily').value.trim();

            if (!cdnUrl || !fontFamily) {
                alert('Please enter both CDN URL and font-family value');
                return;
            }

            // Add font link to document head
            const link = document.createElement('link');
            link.rel = 'stylesheet';
            link.href = cdnUrl;
            document.head.appendChild(link);

            // Add to all dropdowns
            const dropdowns = ['headingFont', 'bodyFont', 'codeFont'];
            dropdowns.forEach(id => {
                const select = document.getElementById(id);
                const option = document.createElement('option');
                option.value = fontFamily;
                option.textContent = fontFamily.replace(/['"]/g, '') + ' (Custom)';
                select.insertBefore(option, select.firstChild);
            });

            // Clear inputs and show feedback
            document.getElementById('fontCdnUrl').value = '';
            document.getElementById('fontFamily').value = '';
            document.getElementById('fontCdnUrl').placeholder = '‚úì Font added! Add another or select from dropdowns';

            setTimeout(() => {
                document.getElementById('fontCdnUrl').placeholder = 'https://fonts.googleapis.com/css2?family=...';
            }, 3000);
        }

        function resetTokens() {
            // Reset colors
            Object.entries(defaultTokens).forEach(([token, value]) => {
                updateToken(token, value);
            });

            // Reset fonts
            document.getElementById('headingFont').value = defaultFonts.heading;
            document.getElementById('bodyFont').value = defaultFonts.body;
            document.getElementById('codeFont').value = defaultFonts.code;

            updateFont('heading', defaultFonts.heading);
            updateFont('body', defaultFonts.body);
            updateFont('code', defaultFonts.code);

            // Clear custom font inputs
            document.getElementById('fontCdnUrl').value = '';
            document.getElementById('fontFamily').value = '';

            // Visual feedback
            const btn = document.getElementById('resetTokensBtn');
            const originalText = btn.textContent;
            btn.textContent = 'Reset!';
            setTimeout(() => {
                btn.textContent = originalText;
            }, 1000);
        }

        function copyTokens() {
            const tokens = [
                '--bg-primary',
                '--bg-secondary',
                '--bg-tertiary',
                '--text-primary',
                '--text-secondary',
                '--accent-primary',
                '--accent-secondary',
                '--success',
                '--warning',
                '--error',
                '--border',
                '--highlight'
            ];

            const style = getComputedStyle(document.documentElement);

            // Generate CSS custom properties
            let cssOutput = ':root {\n';
            tokens.forEach(token => {
                const value = style.getPropertyValue(token).trim();
                cssOutput += `    ${token}: ${value};\n`;
            });
            cssOutput += '}\n\n';

            // Add font info
            cssOutput += '/* Fonts */\n';
            const headingFont = document.getElementById('headingFont').value;
            const bodyFont = document.getElementById('bodyFont').value;
            const codeFont = document.getElementById('codeFont').value;

            cssOutput += `/* Heading: ${headingFont} */\n`;
            cssOutput += `/* Body: ${bodyFont} */\n`;
            cssOutput += `/* Code: ${codeFont} */\n`;

            // Copy to clipboard
            navigator.clipboard.writeText(cssOutput).then(() => {
                const btn = document.getElementById('copyTokensBtn');
                const originalText = btn.textContent;
                btn.textContent = '‚úì Copied!';
                btn.classList.add('copied');

                setTimeout(() => {
                    btn.textContent = originalText;
                    btn.classList.remove('copied');
                }, 2000);
            }).catch(err => {
                console.error('Failed to copy:', err);
                alert('Failed to copy tokens to clipboard');
            });
        }

        function loadTokens() {
            const cssText = prompt('Paste the CSS (including :root { } and font comments):');

            if (!cssText) return;

            try {
                // Extract color tokens
                const tokenRegex = /--([a-z-]+):\s*([^;]+);/g;
                let match;

                while ((match = tokenRegex.exec(cssText)) !== null) {
                    const tokenName = '--' + match[1];
                    const value = match[2].trim();

                    if (defaultTokens.hasOwnProperty(tokenName)) {
                        updateToken(tokenName, value);
                    }
                }

                // Extract font info from comments
                const headingMatch = cssText.match(/\/\*\s*Heading:\s*([^*]+)\*\//);
                const bodyMatch = cssText.match(/\/\*\s*Body:\s*([^*]+)\*\//);
                const codeMatch = cssText.match(/\/\*\s*Code:\s*([^*]+)\*\//);

                if (headingMatch) {
                    const font = headingMatch[1].trim();
                    document.getElementById('headingFont').value = font;
                    updateFont('heading', font);
                }

                if (bodyMatch) {
                    const font = bodyMatch[1].trim();
                    document.getElementById('bodyFont').value = font;
                    updateFont('body', font);
                }

                if (codeMatch) {
                    const font = codeMatch[1].trim();
                    document.getElementById('codeFont').value = font;
                    updateFont('code', font);
                }

                // Visual feedback
                const btn = document.getElementById('loadTokensBtn');
                const originalText = btn.textContent;
                const originalBg = btn.style.background;
                btn.textContent = '‚úì Loaded!';
                btn.style.background = 'var(--success)';

                setTimeout(() => {
                    btn.textContent = originalText;
                    btn.style.background = originalBg;
                }, 2000);

            } catch (err) {
                console.error('Failed to parse CSS:', err);
                alert('Failed to parse CSS. Make sure it includes :root { } block and font comments.');
            }
        }

        // Close design panel when clicking outside
        document.addEventListener('click', (e) => {
            const panel = document.getElementById('designPanel');
            const fab = document.getElementById('designFab');
            if (panel.classList.contains('visible') &&
                !panel.contains(e.target) &&
                !fab.contains(e.target)) {
                panel.classList.remove('visible');
            }
        });
    </script>
</body>
</html>
