# TDOC - Tetra Document Manager

A TCS 3.0-compliant Tetra module for managing and categorizing LLM-generated markdown documentation with color-coded previews, interactive tagging, and RAG evidence integration.

## Features

- **Core/Other Taxonomy** - Distinguish stable reference docs from time-sensitive working docs
- **Color-Coded Previews** - Beautiful markdown rendering using TDS (Tetra Display System)
- **Interactive Tagging** - Easy tag management with visual color feedback
- **Timestamp Database** - TCS 3.0-compliant timestamped metadata storage
- **RAG Integration** - Provides weighted evidence lists to improve RAG query context
- **Auto-Detection** - Suggests metadata based on filename, location, and content
- **Module-Aware** - Automatically detects and organizes module-specific documentation

## Installation

The tdoc module is part of the Tetra system. Source it via:

```bash
source $TETRA_SRC/bash/tdocs/includes.sh
```

Or let the Tetra module system auto-discover it.

## Quick Start

### Initialize a Document

```bash
# Interactive mode (recommended for first-time use)
tdoc init bash/rag/docs/NEW_FEATURE.md

# Non-interactive mode
tdoc init docs/API_SPEC.md --core --type spec
```

### View a Document

```bash
# Color preview with metadata
tdoc view bash/rag/docs/REPL_FIXES_20251016.md

# With pager
tdoc view --pager docs/guide.md

# Metadata only
tdoc view --meta-only report.md
```

### List Documents

```bash
# All documents
tdoc list

# Core documents only
tdoc list --core

# By module
tdoc list --module rag

# By tags
tdoc list --tags bug-fix,repl

# With metadata preview
tdoc list --preview
```

### Interactive Tagging

```bash
tdoc tag bash/rag/docs/REPL_FIXES_20251016.md
```

Interactive editor allows adding/removing tags with color preview:

```
┌─ Tag Editor: REPL_FIXES_20251016.md
│
│ Category: [other]  Type: [bug-fix]
│ Module: [rag]
│
│ Current tags:
│   ◆ bug-fix  ◆ rag  ◆ repl  ◆ 2025-10-16
│
│ Commands:
│   +<tag>  - Add tag
│   -<tag>  - Remove tag
│   done    - Save and exit
└─

Command: +completion
```

### Search

```bash
# Full-text search
tdoc search "bash completion"

# Get evidence for RAG
tdoc evidence "repl history system"

# Primary evidence only (core docs)
tdoc evidence --primary "tetra architecture"
```

### Audit

```bash
# Find documents without metadata
tdoc audit

# Rebuild indexes
tdoc index --rebuild
```

## Document Taxonomy

### Categories

**CORE** - Stable, authoritative reference documentation
- Location: `$TETRA_SRC/docs/reference/`, `/guide/`, `/theory/`, `/workflow/`
- Characteristics: Manually curated, version controlled carefully
- Evidence Weight: PRIMARY (1.0)

**OTHER** - Time-sensitive working documents
- Location: Module-local `bash/<module>/docs/` or project root
- Characteristics: Auto-generated by LLMs, time-sensitive
- Evidence Weight: SECONDARY (0.5) or TERTIARY (0.2)

### Document Types

**Core Types**:
- `spec` - Specifications and contracts
- `guide` - How-to guides and tutorials
- `reference` - API references and lookups

**Other Types**:
- `bug-fix` - Bug fix documentation
- `refactor` - Refactoring notes
- `plan` - Planning documents
- `summary` - Session summaries
- `investigation` - Problem analysis
- `spike` - Exploratory work

### Tags

Tags are free-form but follow conventions:

**Temporal Tags**: `YYYY-MM-DD` format (auto-detected from filenames)

**Purpose Tags**: `bug-fix`, `refactor`, `plan`, `summary`, `investigation`

**Scope Tags**: Module names (`rag`, `tsm`, `tmod`), feature areas

**Custom Tags**: Any descriptive tags relevant to the document

## Metadata Schema

Documents can have YAML frontmatter:

```yaml
---
category: other
type: bug-fix
tags: [bug-fix, rag, repl, 2025-10-16]
module: rag
created: 2025-10-16
updated: 2025-10-16
status: stable
evidence_weight: secondary
---
```

## Database Structure

TCS 3.0-compliant timestamp-based database:

```
$TETRA_DIR/tdoc/
├── db/
│   ├── 1760229927.meta       # JSON metadata
│   ├── 1760229927.tags       # Tag list (for grep)
│   └── ...
├── config/
└── cache/
```

Each `.meta` file contains:

```json
{
  "timestamp": 1760229927,
  "doc_path": "/path/to/doc.md",
  "category": "other",
  "type": "bug-fix",
  "tags": ["bug-fix", "rag", "repl"],
  "module": "rag",
  "evidence_weight": "secondary",
  "created": "2025-10-16T03:40:00Z",
  "updated": "2025-10-16T03:40:00Z",
  "status": "stable",
  "hash": "abc123..."
}
```

## RAG Integration

### Evidence Provider

tdoc provides weighted document lists to RAG queries:

```bash
# In RAG module
tdoc evidence "bash completion system"
```

Output:

```
1.0 /path/to/Tetra_Core_Specification.md [core/spec] ["architecture", "core"]
0.7 /path/to/bash/rag/docs/REPL_FIXES_20251016.md [other/bug-fix] ["bug-fix", "completion"]
0.5 /path/to/bash/rag/docs/HISTORY_COMPLETION_GUIDE.md [other/guide] ["guide", "completion"]
```

### Integration Example

```bash
# In bash/rag/core/evidence_selector.sh
local doc_list=$(tdoc evidence "$query" --tags "${relevant_tags}")

# Use doc_list as evidence for RAG context assembly
for doc in $doc_list; do
    # Extract path and weight
    # Add to evidence bundle
done
```

## Color System

tdoc uses TDS (Tetra Display System) for color-coded output:

- **Category badges**: Blue (CORE), Orange (OTHER)
- **Type tags**: Semantic colors based on type
- **Status indicators**: Green (stable), Gray (draft), Red (deprecated)
- **Module tags**: Accent colors
- **Markdown rendering**: Full TDS semantic color tokens

## TUI Integration

Minimal read-only actions for demo 014:

- `list:docs` - List core documentation
- `view:doc` - Preview document with colors
- `list:module_docs` - List module-specific docs
- `search:docs` - Search documentation

## CLI Reference

```
tdoc init <file> [OPTIONS]       Initialize document with metadata
tdoc view <file> [OPTIONS]       Preview with color rendering
tdoc tag <file>                  Interactive tag editor
tdoc list [OPTIONS]              List documents
tdoc search <query>              Full-text search
tdoc evidence <query> [OPTIONS]  Get evidence list for RAG
tdoc audit                       Find docs without metadata
tdoc index [--rebuild]           Manage indexes
tdoc help                        Show help
```

## Module Interface

tdoc implements the standard Tetra module interface:

```bash
tdoc_module_init()        # Initialize module
tdoc_module_actions()     # List available actions
tdoc_module_properties()  # List managed properties
tdoc_module_info()        # Show module status
```

## Dependencies

- **TDS** (`bash/tds/`) - For color rendering
- **Tetra Color System** (`bash/color/`) - Via TDS
- **Bash 5.2+** - For associative arrays
- **Standard Unix tools** - grep, sed, awk, date, shasum

## Examples

### Example 1: Document a Bug Fix

```bash
# Create fix document
vim bash/rag/docs/COMPLETION_FIX_20251017.md

# Initialize with metadata
tdoc init bash/rag/docs/COMPLETION_FIX_20251017.md

# Interactive prompts:
# Category: other
# Type: bug-fix (auto-detected)
# Tags: bug-fix,rag,completion,2025-10-17 (suggested)
# Module: rag (auto-detected)

# View result
tdoc view bash/rag/docs/COMPLETION_FIX_20251017.md
```

### Example 2: Add Core Specification

```bash
# Create spec
tdoc init docs/reference/Module_System_Spec.md \
  --core \
  --type spec \
  --tags architecture,modules,tcs-3.0

# Verify
tdoc list --core
```

### Example 3: Find Related Docs for RAG Query

```bash
# Get evidence for a query
tdoc evidence "tab completion" --tags rag

# Outputs weighted list of relevant docs
# Use in RAG context assembly
```

## Best Practices

1. **Initialize early** - Run `tdoc init` on new docs immediately
2. **Use auto-detection** - Let tdoc suggest metadata in interactive mode
3. **Tag consistently** - Use established tag conventions
4. **Core vs Other** - Be strict: core is for stable references only
5. **Update regularly** - Use `tdoc audit` to find missing metadata
6. **Rebuild indexes** - Run `tdoc index --rebuild` after bulk changes

## Troubleshooting

**No color output?**
- Check TDS is loaded: `echo $TDS_LOADED`
- Source TDS: `source $TETRA_SRC/bash/tds/tds.sh`

**Metadata not found?**
- Run `tdoc audit` to find untracked docs
- Check database: `ls $TETRA_DIR/tdoc/db/`

**Search not working?**
- Rebuild index: `tdoc index --rebuild`
- Check permissions on `$TETRA_DIR/tdoc/`

## Version

tdoc 1.0.0 - TCS 3.0 Compliant

## License

Part of the Tetra system.
