---
category: core
type: spec
tags: [tdoc,documentation,design]
created: 2025-10-17
updated: 2025-10-17
status: draft
evidence_weight: primary
---


# Tetra Document Management System (tdoc)

## Problem Statement

LLMs generate many markdown documents during development. These fall into two categories:

1. **Core docs** - Stable reference documentation (specs, guides, architecture)
2. **Other docs** - Time-sensitive working documents (bug fixes, refactors, plans)

Current issues:
- No clear distinction between core and transient docs
- LLM-generated docs dumped into local `./docs` without context hierarchy
- No metadata for filtering by time, purpose, or relevance
- No integration with RAG evidence system for query enhancement

## Taxonomy

### Document Categories

#### Core Documents
**Location**: `$TETRA_SRC/docs/` with subdirs
- `reference/` - Specifications, conventions, system design
- `guide/` - How-to guides, tutorials
- `theory/` - Conceptual/mathematical foundations
- `workflow/` - Development processes

**Characteristics**:
- Stable, authoritative
- Manually curated
- Version controlled carefully
- Primary evidence for RAG queries

#### Other Documents
**Location**: Module-local or time-stamped
- `bash/<module>/docs/` - Module-specific working docs
- Project root for temporary planning docs

**Characteristics**:
- Time-sensitive
- Auto-generated by LLMs
- Tagged with purpose/context
- Secondary evidence, filtered by tags

### Metadata Schema

All documents can have YAML frontmatter:

```yaml
```

### Tag System for "Other" Documents

**Purpose Tags**:
- `bug-fix` - Fixes specific bugs
- `refactor` - Code cleanup/restructuring
- `plan` - Future work planning
- `summary` - Session/task summaries
- `investigation` - Problem analysis
- `spike` - Exploratory work

**Temporal Tags**:
- `YYYY-MM-DD` - Auto-added from filename or creation date
- `session` - Documents scoped to a single work session

**Scope Tags**:
- Module names (e.g., `rag`, `tsm`, `tmod`)
- Feature areas (e.g., `completion`, `history`, `state`)

## Tool Design: `tdoc`

### Commands

```bash
# Initialize document metadata
tdoc init <file>           # Interactive metadata creation
tdoc init --core <file>    # Mark as core document
tdoc init --other <file> --tags bug-fix,rag

# Classify and move documents
tdoc classify <file>       # Suggest location based on metadata
tdoc move <file> --to core/reference  # Move and update index

# Query/List documents
tdoc list --core          # List all core docs
tdoc list --other         # List all other docs
tdoc list --module rag    # List module-specific docs
tdoc list --tags refactor # List by tag

# Search
tdoc search <query>       # Full-text search with category weighting
tdoc find --tags bug-fix --since 2025-10-01

# Evidence system integration
tdoc evidence <query>     # Show docs relevant as evidence
tdoc evidence --primary   # Show only core docs
tdoc evidence --tags refactor,rag  # Filtered other docs

# Maintenance
tdoc audit               # Find docs without metadata
tdoc archive --before 2025-09-01  # Move old docs to archive
tdoc index --rebuild     # Rebuild .tdoc index files
```

### Index Files

Each docs directory has a `.tdoc/index.json`:

```json
{
  "core": [
    {
      "path": "reference/Tetra_Core_Specification.md",
      "category": "core",
      "type": "spec",
      "tags": ["architecture", "core"],
      "evidence_weight": "primary",
      "updated": "2025-10-17"
    }
  ],
  "other": [
    {
      "path": "../bash/rag/docs/REPL_FIXES_20251016.md",
      "category": "other",
      "type": "bug-fix",
      "tags": ["bug-fix", "rag", "repl", "2025-10-16"],
      "module": "rag",
      "evidence_weight": "secondary",
      "created": "2025-10-16"
    }
  ]
}
```

## Directory Structure

```
tetra/
├── docs/
│   ├── .tdoc/
│   │   └── index.json          # Global core index
│   ├── reference/              # Core specs/reference
│   ├── guide/                  # Core guides
│   ├── theory/                 # Core theory
│   ├── workflow/               # Core workflows
│   └── archive/                # Archived other docs
│       └── 2025-Q3/
├── bash/
│   ├── rag/
│   │   └── docs/
│   │       ├── .tdoc/
│   │       │   └── index.json  # Module doc index
│   │       ├── core/           # Module core docs (rare)
│   │       └── *.md            # Module other docs
│   └── tsm/
│       └── docs/
│           └── ...
```

## Integration with RAG System

### Evidence Tagging

When RAG builds evidence for a query:

```bash
# In rag/core/evidence_selector.sh
tdoc evidence "bash completion repl" --weights primary:1.0,secondary:0.5

# Returns:
# PRIMARY:
#   docs/reference/Tetra_Core_Specification.md
# SECONDARY (filtered):
#   bash/rag/docs/REPL_FIXES_20251016.md (tags: bug-fix, repl)
#   bash/rag/docs/HISTORY_COMPLETION_GUIDE.md (tags: guide, completion)
```

### Automatic Tagging

When LLM generates a doc:

1. Detect if it's in response to bug/refactor/plan request
2. Auto-add frontmatter with appropriate tags
3. Suggest classification and location
4. Update module's `.tdoc/index.json`

## Migration Plan

### Phase 1: Core Classification
1. Add frontmatter to existing `docs/reference/*` as core
2. Create `.tdoc/index.json` for core docs
3. Implement `tdoc list --core`

### Phase 2: Other Classification
1. Audit module `docs/` directories
2. Add frontmatter with tags to LLM-generated docs
3. Create module `.tdoc/index.json` files
4. Implement `tdoc list --other --module <name>`

### Phase 3: RAG Integration
1. Modify evidence selector to use tdoc
2. Add evidence weight filtering
3. Implement tag-based relevance scoring

### Phase 4: Automation
1. Hook into LLM doc generation (via Claude Code)
2. Auto-suggest metadata based on context
3. Auto-update indexes

## Benefits

1. **Clear taxonomy** - Core vs other with explicit metadata
2. **Temporal filtering** - Find recent/relevant working docs
3. **Scope filtering** - Module-specific doc discovery
4. **RAG integration** - Better evidence selection for queries
5. **Maintenance** - Easy archival of stale docs
6. **Discovery** - Search by purpose, not just location

## Example Workflow

```bash
# LLM just fixed a bug and generated REPL_FIXES_20251016.md
tdoc init bash/rag/docs/REPL_FIXES_20251016.md \
  --other \
  --tags bug-fix,repl,completion \
  --module rag

# Later, preparing RAG query about completion
tdoc evidence "tab completion" --module rag --tags completion
# Shows both core docs about completion AND recent bug fixes

# Quarterly cleanup
tdoc list --other --before 2025-07-01 --status resolved
tdoc archive --before 2025-07-01 --status resolved
```
