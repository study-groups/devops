<!DOCTYPE html>
<html lang="en" data-theme="lava">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pixeljam Arcade</title>

  <!-- Fonts: Load early for text rendering -->
  <link rel="stylesheet" href="assets/fonts.css">

  <!-- Critical CSS: Inline to prevent FOUC -->
  <style id="critical-css">
    * { box-sizing: border-box; margin: 0; padding: 0; }

    html, body {
      height: 100%;
      background: var(--color-background, #1c1f25);
      color: var(--ink, #bbbbbb);
      font-family: var(--font-body, 'AG', system-ui, sans-serif);
    }

    /* Loading screen - shown until bootloader completes */
    #pja-loading {
      position: fixed;
      inset: 0;
      z-index: 9999;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      background: var(--shade, #130902);
      transition: opacity 0.3s ease-out;
    }

    #pja-loading.fade-out {
      opacity: 0;
      pointer-events: none;
    }

    .loading-logo {
      width: 252px;
      height: 52px;
      margin-bottom: 2rem;
      color: var(--one, #ff9900);
      font-family: var(--font-display, 'PJ43', system-ui, sans-serif);
      font-size: 3rem;
      letter-spacing: 0.15em;
    }

    .loading-bar-container {
      width: 200px;
      height: 4px;
      background: var(--paper-dark, rgba(255,255,255,0.1));
      border-radius: 2px;
      overflow: hidden;
    }

    .loading-bar {
      height: 100%;
      width: 0%;
      background: var(--one, #ff9900);
      transition: width 0.2s ease-out;
    }

    .loading-status {
      margin-top: 1rem;
      font-size: 0.75rem;
      color: var(--text-muted, rgba(255,255,255,0.5));
      text-transform: uppercase;
      letter-spacing: 0.1em;
    }

    /* Hide app until loaded */
    #pja-app {
      opacity: 0;
      transition: opacity 0.3s ease-in;
    }

    #pja-app.loaded {
      opacity: 1;
    }
  </style>

  <!-- Theme hydration: Apply saved theme before render -->
  <script>
    (function() {
      const theme = localStorage.getItem('pja-theme') || 'lava';
      document.documentElement.setAttribute('data-theme', theme);
    })();
  </script>

  <!-- Core CSS bundle: Load synchronously -->
  <link rel="stylesheet" href="styles/bundles/core.bundle.css">

  <!-- Features CSS: Load async to not block render -->
  <link rel="stylesheet" href="styles/bundles/features.bundle.css"
        media="print" onload="this.media='all'">

  <!-- Terrain Design System (tokens + FAB) -->
  <link rel="stylesheet" href="terrain/css/tokens.css">
  <link rel="stylesheet" href="terrain/css/components/fab.css">

  <!-- Import map for ES modules -->
  <script type="importmap">
  {
    "imports": {
      "@core/": "./modules/core/",
      "@services/": "./modules/services/",
      "@components/": "./modules/components/",
      "@pages/": "./modules/pages/",
      "@store/": "./modules/store/"
    }
  }
  </script>
</head>
<body>
  <!-- Loading screen -->
  <div id="pja-loading">
    <!-- Text logo using PJ43 font -->
    <div class="loading-logo" aria-label="Pixeljam Arcade">ARCADE</div>
    <div class="loading-bar-container">
      <div class="loading-bar" id="loadingBar"></div>
    </div>
    <div class="loading-status" id="loadingStatus">Initializing...</div>
  </div>

  <!-- Main application container -->
  <div id="pja-app">
    <!-- Content injected by router/pages -->
  </div>

  <!-- Terrain Design System -->
  <script src="terrain/js/core/terrain-css.js"></script>

  <!-- Bootloader: Initializes everything -->
  <script type="module" src="bootloader.js"></script>

  <!-- SVG Definitions (at bottom, referenced via <use href="#id">) -->
  <svg id="svg-defs" xmlns="http://www.w3.org/2000/svg" style="position:absolute;width:0;height:0;overflow:hidden">
    <defs>
      <g id="svg_arcade_logo">
        <path d="M28,20L12,20L12,28L0,28L-0,0L28,-0L28,20ZM24,4L4,4L4,24L8,24L8,16L24,16L24,4Z"/>
        <path d="M60,8L64,8L64,0L76,-0L76,12L68,12L68,16L76,16L76,28L64,28L64,20L60,20L60,28L48,28L48,16L56,16L56,12L48,12L48,0L60,-0L60,8ZM56,8L56,4L52,4L52,8L56,8ZM60,16L64,16L64,12L60,12L60,16ZM56,20L52,20L52,24L56,24L56,20ZM68,20L68,24L72,24L72,20L68,20ZM68,8L72,8L72,4L68,4L68,8Z"/>
        <path d="M124,16L140,16L140,28L112,28L112,0L124,-0L124,16ZM120,18L120,4L116,4L116,24L136,24L136,20L120,20L120,18Z"/>
        <path d="M160,16L160,0L172,-0L172,28L144,28L144,16L160,16ZM162,20L148,20L148,24L168,24L168,4L164,4L164,20L162,20Z"/>
        <path d="M204,28L192,28L192,20L188,20L188,28L176,28L176,0L204,-0L204,28ZM200,4L180,4L180,24L184,24L184,16L196,16L196,24L200,24L200,4Z"/>
        <path d="M228,8L232,8L232,0L252,-0L252,28L240,28L240,20L236,20L236,28L224,28L224,20L220,20L220,28L208,28L208,0L228,-0L228,8ZM224,10L224,4L212,4L212,24L216,24L216,16L228,16L228,24L232,24L232,16L244,16L244,24L248,24L248,4L236,4L236,12L224,12L224,10Z"/>
        <path d="M44,28L32,28L32,0L44,-0L44,28ZM40,4L36,4L36,24L40,24L40,4Z"/>
        <path d="M108,12L80,12L80,0L108,-0L108,12ZM104,4L84,4L84,8L104,8L104,4Z"/>
        <path d="M108,28L80,28L80,16L108,16L108,28ZM104,20L84,20L84,24L104,24L104,20Z"/>
        <path d="M0,32L0,52L4,52L4,44L12,44L12,52L16,52L16,32L0,32ZM12,40L4,40L4,36L12,36L12,40Z"/>
        <path d="M24,44L28,44L28,52L36,52L36,48L32,48L32,44L36,44L36,32L20,32L20,52L24,52L24,44ZM24,36L32,36L32,40L24,40L24,36Z"/>
        <path d="M40,32L40,52L56,52L56,48L44,48L44,36L56,36L56,32L40,32Z"/>
        <path d="M60,32L60,52L64,52L64,44L72,44L72,52L76,52L76,32L60,32ZM72,40L64,40L64,36L72,36L72,40Z"/>
        <path d="M92,47.968L92,36.032L84,36.032L84,47.968L92,47.968ZM92,52L80,52L80,32L92,32L92,36L96,36L96,48L92,48L92,52Z"/>
        <path d="M116,52L116,48L104,48L104,44L116,44L116,40L104,40L104,36L116,36L116,32L100,32L100,52L116,52Z"/>
      </g>
      <g id="svg_arcade_text">
        <path d="M28,20L12,20L12,28L0,28L-0,0L28,-0L28,20ZM24,4L4,4L4,24L8,24L8,16L24,16L24,4Z"/>
        <path d="M60,8L64,8L64,0L76,-0L76,12L68,12L68,16L76,16L76,28L64,28L64,20L60,20L60,28L48,28L48,16L56,16L56,12L48,12L48,0L60,-0L60,8ZM56,8L56,4L52,4L52,8L56,8ZM60,16L64,16L64,12L60,12L60,16ZM56,20L52,20L52,24L56,24L56,20ZM68,20L68,24L72,24L72,20L68,20ZM68,8L72,8L72,4L68,4L68,8Z"/>
        <path d="M124,16L140,16L140,28L112,28L112,0L124,-0L124,16ZM120,18L120,4L116,4L116,24L136,24L136,20L120,20L120,18Z"/>
        <path d="M160,16L160,0L172,-0L172,28L144,28L144,16L160,16ZM162,20L148,20L148,24L168,24L168,4L164,4L164,20L162,20Z"/>
        <path d="M204,28L192,28L192,20L188,20L188,28L176,28L176,0L204,-0L204,28ZM200,4L180,4L180,24L184,24L184,16L196,16L196,24L200,24L200,4Z"/>
        <path d="M228,8L232,8L232,0L252,-0L252,28L240,28L240,20L236,20L236,28L224,28L224,20L220,20L220,28L208,28L208,0L228,-0L228,8ZM224,10L224,4L212,4L212,24L216,24L216,16L228,16L228,24L232,24L232,16L244,16L244,24L248,24L248,4L236,4L236,12L224,12L224,10Z"/>
        <path d="M44,28L32,28L32,0L44,-0L44,28ZM40,4L36,4L36,24L40,24L40,4Z"/>
        <path d="M108,12L80,12L80,0L108,-0L108,12ZM104,4L84,4L84,8L104,8L104,4Z"/>
        <path d="M108,28L80,28L80,16L108,16L108,28ZM104,20L84,20L84,24L104,24L104,20Z"/>
      </g>
    </defs>
  </svg>
</body>
</html>
