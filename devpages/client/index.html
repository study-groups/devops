<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0 maximum-scale=1">
    <meta name="app-version" content="v0.13m1">
    <title>DevPages</title>
    <link rel="icon" type="image/x-icon" href="/client/favicon.ico">

    <!-- Console filter: Controls verbose [bracketed] logging. Must load first. -->
    <script src="/client/utils/console-filter.js"></script>

    <!-- CRITICAL: Synchronous theme initialization MUST run BEFORE CSS loads -->
    <!-- This ensures CSS variables are set before CSS bundles parse -->
    <script src="/client/services/ThemeInitializer.js"></script>

    <!-- All CSS is now loaded via bundles. Preloads are no longer necessary. -->

    <!-- CSS Loading Strategy: Bundled for Performance -->
    <!-- Core Bundle: Critical foundation styles (load immediately) -->
    <link rel="stylesheet" href="/css/bundles/core.bundle.css?v=3" data-scope="editor">

    <!-- Layout Bundle: Critical workspace layout (load immediately) -->
    <link rel="stylesheet" href="/css/bundles/layout.bundle.css?v=3" data-scope="editor">

    <!-- Features Bundle: Major features (load async) -->
    <link rel="stylesheet" href="/css/bundles/features.bundle.css?v=3" media="print" onload="this.media='all'" data-scope="editor">

    <!-- Panels Bundle: Panel-specific styles (load immediately) -->
    <link rel="stylesheet" href="/css/bundles/panels.bundle.css?v=4" data-scope="editor">

    <!-- Design Tokens Panel CSS (fallback) -->
    <link rel="stylesheet" href="/client/styles/design-tokens-panel.css" data-scope="editor">

    <!-- Theme Management Panel CSS -->
    <link rel="stylesheet" href="/client/styles/theme-management-panel.css" data-scope="editor">

    <!-- Log CSS -->
    <link rel="stylesheet" href="/client/log/log-display.css" data-scope="editor">
    
    
    <!-- Introspection System: Load for debugging and development -->
    <script type="module" src="/client/utils/IntrospectionBootstrap.js"></script>
    
    <!-- Fallback for browsers that don't support onload -->
    <noscript>
        <link rel="stylesheet" href="/css/bundles/core.bundle.css">
        <link rel="stylesheet" href="/css/bundles/layout.bundle.css">
        <link rel="stylesheet" href="/css/bundles/features.bundle.css">
        <link rel="stylesheet" href="/css/bundles/panels.bundle.css">
    </noscript>

    <script src="/client/errorTracker.js"></script>

    <!-- Import Map for ES Module Resolution -->
    <script type="importmap">
    {
        "imports": {
            "@reduxjs/toolkit": "/node_modules/@reduxjs/toolkit/dist/redux-toolkit.browser.mjs?v=1",
            "@reduxjs/toolkit/query": "/node_modules/@reduxjs/toolkit/dist/query/rtk-query.browser.mjs",
            "@standard-schema/utils": "/node_modules/@standard-schema/utils/dist/index.js",
            "redux": "/node_modules/redux/dist/redux.browser.mjs",
            "redux-thunk": "/node_modules/redux-thunk/dist/redux-thunk.mjs",
            "immer": "/node_modules/immer/dist/immer.production.mjs",
            "reselect": "/node_modules/reselect/dist/reselect.browser.mjs",
            "/appState.js": "/client/appState.js",
            "/eventBus.js": "/client/eventBus.js",
            "/panels/": "/client/panels/",
            "/store/": "/client/store/",
            "/utils/": "/client/utils/",
            "/log/": "/client/log/",
            "/api/": "/client/api/",
            "/services/": "/client/services/",
            "/components/": "/client/components/",
            "/layout/": "/client/layout/",
            "/core/": "/client/core/"
        }
    }
    </script>
    
    <!-- Markdown-it Loader: Required for the preview panel -->
    <script>
        function initMarkdownIt() {
            return new Promise((resolve, reject) => {
                const script = document.createElement('script');
                script.src = '/client/vendor/scripts/markdown-it.min.js';
                script.onload = () => {
                    window.APP.services = window.APP.services || {};
                    window.APP.services.markdownit = window.markdownit;
                    resolve();
                };
                script.onerror = reject;
                document.head.appendChild(script);
            });
        }
    </script>
</head>
<body class="splash-active">
    <!-- Body theme class is set by ThemeInitializer.js in head -->
    <div id="devpages-splash">
        <div class="splash-content">
            <div class="splash-logo">DevPages</div>
            <div class="splash-version">v0.13m1</div>
        </div>
    </div>

    <nav class="top-bar top-bar-full">
        <div id="context-manager-container" class="nav-group context-selector"></div>
        <div id="view-controls-container" class="nav-group view-controls">
            <button id="sidebar-toggle" class="btn btn-ghost btn-sm" data-action="toggleSidebar" title="Toggle Sidebar"></button>
            <button id="edit-toggle" class="btn btn-ghost btn-sm" data-action="toggleEdit" title="Toggle Editor"></button>
            <button id="preview-toggle" class="btn btn-ghost btn-sm" data-action="togglePreview" title="Toggle Preview"></button>
            <button id="log-toggle-btn" class="btn btn-ghost btn-sm" data-action="toggleLogVisibility" title="Toggle Log"></button>
            <button id="refresh-btn" class="btn btn-ghost btn-sm" data-action="refreshPreview" title="Refresh Preview"></button>
        </div>
        <div class="nav-group right-group">
            <button id="save-btn" class="btn btn-sm" data-action="saveFile" title="Save File (Ctrl+S)" disabled>Save</button>
            <div id="auth-component-container" class="auth-info"></div>
        </div>
    </nav>

    <!-- Main Workspace -->
    <div class="workspace-container">
        <!-- Sidebar (Left) -->
        <div id="workspace-sidebar" class="workspace-sidebar"></div>

        <!-- Resizer -->
        <div class="resizer" data-resizer-for="sidebar"></div>

        <!-- Editor (Center) -->
        <div id="workspace-editor" class="workspace-editor"></div>

        <!-- Resizer -->
        <div class="resizer" data-resizer-for="preview"></div>

        <!-- Preview (Right) -->
        <div id="workspace-preview" class="workspace-preview"></div>
    </div>

    <!-- Log/Terminal (Bottom) -->
    <!-- Default: log-visible to match Redux default logVisible: true -->
    <div id="log-container" class="log-visible"></div>

    <!-- Console Tools Registry (load before tool IIFEs) -->
    <script src="/client/utils/console-tools-registry.js"></script>

    <!-- Console telemetry (opt-in via: telemetry.enable()) -->
    <script src="/client/utils/telemetry.js"></script>

    <script type="module" src="/client/index.js"></script>
</body>
</html>
